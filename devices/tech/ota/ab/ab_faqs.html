<!doctype html>
<html  lang="en">
  
<!-- Mirrored from source.android.google.cn/devices/tech/ota/ab/ab_faqs.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Mar 2019 14:14:28 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
          
<title>Frequently Asked Questions &nbsp;|&nbsp; Android Open Source Project</title>

<meta property="og:title" content="Frequently Asked Questions &nbsp;|&nbsp; Android Open Source Project">

  <meta property="og:url" content="ab_faqs-2.html">

  <meta property="og:locale" content="en">


    
    
    
  
        <meta property="og:site_name" content="Android Open Source Project">
    <meta property="og:type" content="website">
    
          <meta name="theme-color" content="#78c257">
    
    <meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="../../../../_pwa/androidsource/manifest.json">
    <link rel="preconnect" href="http://www.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.googleapis.com/" crossorigin>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons">
    <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/css/app.css">
    <noscript>
      <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/css/ce_bundle.css">
    </noscript>
    <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/touchicon-180.png"><link rel="canonical" href="ab_faqs-2.html"></head>
  <body type="article"
        theme="androidsource-theme"
        class=""
        
        layout="docs"
        pending>
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
    <div class="devsite-wrapper"><devsite-header ds-is="header" keep-tabs-visible>
      








<div class="devsite-header--inner">
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="Close menu">
        </button>
        <div class="devsite-product-name-wrapper">
  <a href="../../../../index.html" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo">
  <img src="https://www.gstatic.cn/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/lockup.svg" class="devsite-site-logo" alt="Android Open Source Project">
</a>
            <span class="devsite-product-name">
            <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                              </li>
  </ul>
          </span>
        
</div>        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
                          <devsite-tabs ds-is="tabs" class="upper-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="../../../../setup.html"
   class="gc-analytics-event"
   title="Set up"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Set up"
   >
  Set up
</a>

        </tab>
                        <tab >
          <a href="../../../../compatibility.html"
   class="gc-analytics-event"
   title="Design"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Design"
   >
  Design
</a>

        </tab>
                        <tab >
          <a href="../../../../security.html"
   class="gc-analytics-event"
   title="Secure"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Secure"
   >
  Secure
</a>

        </tab>
                        <tab >
          <a href="../../../audio.html"
   class="gc-analytics-event"
   title="Develop"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Develop"
   >
  Develop
</a>

        </tab>
                        <tab active>
          <a href="../../dalvik.html"
   class="gc-analytics-event"
   title="Configure"
   aria-label="Configure, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: Configure"
   >
  Configure
</a>

        </tab>
                        <tab >
          <a href="../../../../reference.html"
   class="gc-analytics-event"
   title="Reference"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Reference"
   >
  Reference
</a>

        </tab>
            </div>
</devsite-tabs>

                       </div>
          <devsite-search ds-is="search"
            enable-suggestions
                  project-path="">
  <form class="devsite-search-form" action="https://source.android.google.cn/s/results/" method="GET">
    <div class="devsite-search-container">
      <div id="searchbox" class="devsite-searchbox">
                <input placeholder="Search"
          type="text"
          class="devsite-search-field devsite-search-query"
          name="q"
          value=""
          autocomplete="off"
                    aria-label="Search box">
        <div class="devsite-search-image material-icons"></div>
      </div>
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              aria-label="Open search box"></button>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          aria-label="Close search box"></button>
</devsite-search>

        </div>

                <a class="devsite-header-link devsite-top-button button gc-analytics-event"
           href="http://android-review.googlesource.com/"
           data-category="Site-Wide Custom Events"
           data-label="Site header link">
          Go to code
        </a>
                      </div>    </div>  </div>
  <div class="devsite-collapsible-section
    ">
    <div class="devsite-header-background">
                        <div class="devsite-product-id-row">
            <div class="devsite-product-description-row">
                              <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                    <a href="../../dalvik.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Lower Header"
              data-value="1"
          >
            Configure
      
  </a>
        </li>
  </ul>
                                        </div>
                                                                                    </div>
                                      <div class="devsite-doc-set-nav-row">
                              <devsite-tabs ds-is="tabs" class="lower-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="../../dalvik.html"
   class="gc-analytics-event"
   title="ART"
           data-category="Site-Wide Custom Events"
        data-label="Tab: ART"
   >
  ART
</a>

        </tab>
                        <tab >
          <a href="../../datausage.html"
   class="gc-analytics-event"
   title="Data"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Data"
   >
  Data
</a>

        </tab>
                        <tab >
          <a href="../../admin.html"
   class="gc-analytics-event"
   title="Enterprise"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Enterprise"
   >
  Enterprise
</a>

        </tab>
                        <tab >
          <a href="../../health.html"
   class="gc-analytics-event"
   title="Performance"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Performance"
   >
  Performance
</a>

        </tab>
                        <tab >
          <a href="../../config/perms-whitelist.html"
   class="gc-analytics-event"
   title="Permissions"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Permissions"
   >
  Permissions
</a>

        </tab>
                        <tab >
          <a href="../../power.html"
   class="gc-analytics-event"
   title="Power"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Power"
   >
  Power
</a>

        </tab>
                        <tab active>
          <a href="../../ota.html"
   class="gc-analytics-event"
   title="Updates"
   aria-label="Updates, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: Updates"
   >
  Updates
</a>

        </tab>
            </div>
</devsite-tabs>

        </div>
          </div>  </div></div>
  

  </devsite-header>      <devsite-book-nav ds-is="book-nav" scrollbars >
                  

<nav class="devsite-book-nav devsite-nav nocontent">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="Close navigation">
    </button>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
              <ul class="devsite-nav-list">
                      <li class="devsite-nav-item">
                                <a href="../../../../setup.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Set up">
      <span class="devsite-nav-text" >Set up</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../../../compatibility.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Design">
      <span class="devsite-nav-text" >Design</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../../../security.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Secure">
      <span class="devsite-nav-text" >Secure</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../../audio.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Develop">
      <span class="devsite-nav-text" >Develop</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../dalvik.html"
          class="devsite-nav-title gc-analytics-event
            devsite-nav-active"
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Configure">
      <span class="devsite-nav-text" >Configure</span>
        </a>
  
                                            <ul class="devsite-nav-responsive-tabs">
                                                                                                                      <li class="devsite-nav-item">
    <a href="../../dalvik.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: ART">
      <span class="devsite-nav-text" >ART</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../datausage.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Data">
      <span class="devsite-nav-text" >Data</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../admin.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Enterprise">
      <span class="devsite-nav-text" >Enterprise</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../health.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Performance">
      <span class="devsite-nav-text" >Performance</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../config/perms-whitelist.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Permissions">
      <span class="devsite-nav-text" >Permissions</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../power.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Power">
      <span class="devsite-nav-text" >Power</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../ota.html"
     id="devsite-nav-forward"     class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Updates">
      <span class="devsite-nav-text" menu="_book">Updates</span>
        <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="_book">
    </span>
        </a>
  </li>

                                  </ul>
                          </li>
                      <li class="devsite-nav-item">
                                <a href="../../../../reference.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Reference">
      <span class="devsite-nav-text" >Reference</span>
        </a>
  
                                        </li>
                                <li class="devsite-nav-item">
    <a href="http://android-review.googlesource.com/"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Go to code">
      <span class="devsite-nav-text" >Go to code</span>
        </a>
  </li>

                  </ul>
          </div>
          <div class="devsite-mobile-nav-bottom">
                                      <ul class="devsite-nav-list" menu="_book">
                                    <li class="devsite-nav-item"><a href="../../ota.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li>
                          <li class="devsite-nav-item"><a href="../tools.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="OTA Tools">OTA Tools</span></a></li>
                          <li class="devsite-nav-item"><a href="../sign_builds.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Signing Builds for Release">Signing Builds for Release</span></a></li>
                          <li class="devsite-nav-item"><a href="../reduce_size.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Reducing OTA Size">Reducing OTA Size</span></a></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="A/B System Updates">A/B System Updates</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../ab.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="ab_implement.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Implementing A/B Updates">Implementing A/B Updates</span></a></li><li class="devsite-nav-item"><a href="ab_faqs-2.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Frequently Asked Questions">Frequently Asked Questions</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="Non-A/B System Updates">Non-A/B System Updates</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../nonab.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="../nonab/block.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Block-Based OTA">Block-Based OTA</span></a></li><li class="devsite-nav-item"><a href="../nonab/inside_packages.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Inside OTA Packages">Inside OTA Packages</span></a></li><li class="devsite-nav-item"><a href="../nonab/device_code.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Device-Specific Code">Device-Specific Code</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item"><a href="../../config/timezone-rules.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Time Zone Rules">Time Zone Rules</span></a></li>
                      </ul>
                                                                                                                                                                            </div>
      </div>
</nav>
              </devsite-book-nav>
      <div id="gc-wrapper">
        <div class="devsite-main-content"
            has-book-nav            has-toc>
          <devsite-toc ds-is="toc" class="devsite-nav"
            ></devsite-toc>
          <devsite-content ds-is="content">
                          

<article class="devsite-article">
  <article class="devsite-article-inner">    
    <div class="devsite-article-meta">
      <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                    <a href="../../../../index.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="1"
          >
            AOSP
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item">
                <div class="devsite-breadcrumb-guillemet material-icons"></div>
                    <a href="../../dalvik.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="2"
          >
            Configure
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item">
                <div class="devsite-breadcrumb-guillemet material-icons"></div>
                    <a href="../../ota.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="3"
          >
            Updates
      
  </a>
        </li>
  </ul>
               <devsite-page-rating position="header" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
          </div>

              <h1 class="devsite-page-title">Frequently Asked Questions</h1>
    
    <devsite-toc ds-is="toc" class="devsite-nav" devsite-toc-embedded
                 ></devsite-toc>

    <div class="devsite-article-body clearfix
      ">

              
  <!--
      Copyright 2018 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->


      <h3>Has Google used A/B OTAs on any devices?</h3>

        <p>
          Yes. The marketing name for A/B updates is <em>seamless updates</em>.
          Pixel and Pixel XL phones from October 2016 shipped with A/B, and
          all Chromebooks use the same <code>update_engine</code>
          implementation of A/B. The necessary platform code implementation is
          public in Android 7.1 and higher.
        </p>

      <h3>Why are A/B OTAs better?</h3>

      <p>A/B OTAs provide a better user experience when taking updates. Measurements
      from monthly security updates show this feature has already proven a success: As
      of May 2017, 95% of Pixel owners are running the latest security update after a
      month compared to 87% of Nexus users, and Pixel users update sooner than Nexus
      users. Failures to update blocks during an OTA no longer result in a device that
      won't boot; until the new system image has successfully booted, Android retains
      the ability to fall back to the previous working system image.</p>

      <h3>How did A/B affect the 2016 Pixel partition sizes?</h3>

      <p>The following table contains details on the shipping A/B configuration versus
      the internally-tested non-A/B configuration:</p>

      <table>
        <tbody>
          <tr>
            <th>Pixel partition sizes</th>
            <th width="33%">A/B</th>
            <th width="33%">Non-A/B</th>
          </tr>
          <tr>
            <td>Bootloader</td>
            <td>50*2</td>
            <td>50</td>
          </tr>
          <tr>
            <td>Boot</td>
            <td>32*2</td>
            <td>32</td>
          </tr>
          <tr>
            <td>Recovery</td>
            <td>0</td>
            <td>32</td>
          </tr>
          <tr>
            <td>Cache</td>
            <td>0</td>
            <td>100</td>
          </tr>
          <tr>
            <td>Radio</td>
            <td>70*2</td>
            <td>70</td>
          </tr>
          <tr>
            <td>Vendor</td>
            <td>300*2</td>
            <td>300</td>
          </tr>
          <tr>
            <td>System</td>
            <td>2048*2</td>
            <td>4096</td>
          </tr>
          <tr>
            <td><strong>Total</strong></td>
            <td><strong>5000</strong></td>
            <td><strong>4680</strong></td>
          </tr>
        </tbody>
      </table>

      <p>A/B updates require an increase of only 320 MiB in flash, with a savings of
      32MiB from removing the recovery partition and another 100MiB preserved by
      removing the cache partition. This balances the cost of the B partitions for
      the bootloader, the boot partition, and the radio partition. The vendor
      partition doubled in size (the vast majority of the size increase). Pixel's
      A/B system image is half the size of the original non-A/B system image.
      </p>

      <p>For the Pixel A/B and non-A/B variants tested internally (only A/B shipped),
      the space used differed by only 320MiB. On a 32GiB device, this is just under
      1%. For a 16GiB device this would be less than 2%, and for an 8GiB device almost
      4% (assuming all three devices had the same system image).</p>

      <h3>Why didn't you use SquashFS?</h3>

      <p>We experimented with SquashFS but weren't able to achieve the performance
      desired for a high-end device. We don't use or recommend SquashFS for handheld
      devices.</p>

      <p>More specifically, SquashFS provided about 50% size savings on the system
      partition, but the overwhelming majority of the files that compressed well were
      the precompiled .odex files. Those files had very high compression ratios
      (approaching 80%), but the compression ratio for the rest of the system
      partition was much lower. In addition, SquashFS in Android 7.0 raised the
      following performance concerns:</p>

      <ul>
        <li>Pixel has very fast flash compared to earlier devices but not a huge
          number of spare CPU cycles, so reading fewer bytes from flash but needing
          more CPU for I/O was a potential bottleneck.</li>
        <li>I/O changes that perform well on an artificial benchmark run on an
          unloaded system sometimes don't work well on real-world use cases under
          real-world load (such as crypto on Nexus 6).</li>
        <li>Benchmarking showed 85% regressions in some places.</li>
        </ul>

      <p>As SquashFS matures and adds features to reduce CPU impact (such as a
      whitelist of commonly-accessed files that shouldn't be compressed), we will
      continue to evaluate it and offer recommendations to device manufacturers.</p>

      <h3>How did you halve the size of the system partition without SquashFS?</h3>

      <p>Applications are stored in .apk files, which are actually ZIP archives. Each
      .apk file has inside it one or more .dex files containing portable Dalvik
      bytecode. An .odex file (optimized .dex) lives separately from the .apk file
      and can contain machine code specific to the device. If an .odex file is
      available, Android can run applications at ahead-of-time compiled speeds
      without having to wait for the code to be compiled each time the application is
      launched. An .odex file isn't strictly necessary: Android can actually run the
      .dex code directly via interpretation or Just-In-Time (JIT) compilation, but an
      .odex file provides the best combination of launch speed and run-time speed if
      space is available.</p>

      <p>Example: For the installed-files.txt from a Nexus 6P running Android 7.1 with
      a total system image size of 2628MiB (2755792836 bytes), the breakdown of the
      largest contributors to overall system image size by file type is as follows:
      </p>

      <table>
      <tbody>
      <tr>
      <td>.odex</td>
      <td>1391770312 bytes</td>
      <td>50.5%</td>
      </tr>
      <tr>
      <td>.apk</td>
      <td>846878259 bytes</td>
      <td>30.7%</td>
      </tr>
      <tr>
      <td>.so (native C/C++ code)</td>
      <td>202162479 bytes</td>
      <td>7.3%</td>
      </tr>
      <tr>
      <td>.oat files/.art images</td>
      <td>163892188 bytes</td>
      <td>5.9%</td>
      </tr>
      <tr>
      <td>Fonts</td>
      <td>38952361 bytes</td>
      <td>1.4%</td>
      </tr>
      <tr>
      <td>icu locale data</td>
      <td>27468687 bytes</td>
      <td>0.9%</td>
      </tr>
      </tbody>
      </table>

      <p>These figures are similar for other devices too, so on Nexus/Pixel
      devices, .odex files take up approximately half the system partition. This meant
      we could continue to use ext4 but write the .odex files to the B partition
      at the factory and then copy them to <code>/data</code> on first boot. The
      actual storage used with ext4 A/B is identical to SquashFS A/B, because if we
      had used SquashFS we would have shipped the preopted .odex files on system_a
      instead of system_b.</p>

      <h3>Doesn't copying .odex files to /data mean the space saved on /system is
      lost on /data?</h3>

      <p>Not exactly. On Pixel, most of the space taken by .odex files is for apps,
      which typically exist on <code>/data</code>. These apps take Google Play
      updates, so the .apk and .odex files on the system image are unused for most of
      the life of the device. Such files can be excluded entirely and replaced by
      small, profile-driven .odex files when the user actually uses each app (thus
      requiring no space for apps the user doesn't use). For details, refer to the
      Google I/O 2016 talk <a href="https://www.youtube.com/watch?v=fwMM6g7wpQ8">The
      Evolution of Art</a>.</p>

      <p>The comparison is difficult for a few key reasons:</p>
      <ul>
      <li>Apps updated by Google Play have always had their .odex files on
      <code>/data</code> as soon as they receive their first update.</li>
      <li>Apps the user doesn't run don't need an .odex file at all.</li>
      <li>Profile-driven compilation generates smaller .odex files than ahead-of-time
      compilation (because the former optimizes only performance-critical code).</li>
      </ul>

      <p>For details on the tuning options available to OEMs, see
      <a href="../../dalvik/configure-2.html">Configuring ART</a>.</p>

      <h3>Aren't there two copies of the .odex files on /data?</h3>

      <p>It's a little more complicated ... After the new system image has been
      written, the new version of dex2oat is run against the new .dex files to
      generate the new .odex files. This occurs while the old system is still running,
      so the old and new .odex files are both on <code>/data</code> at the same time.
      </p>

      <p>The code in OtaDexoptService
      (<code><a href="https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/pm/OtaDexoptService.java#193">frameworks/base/+/master/services/core/java/com/android/server/pm/OtaDexoptService.java</a></code>)
      calls <code>getAvailableSpace</code> before optimizing each package to avoid
      over-filling <code>/data</code>. Note that <em>available</em> here is still
      conservative: it's the amount of space left <em>before</em> hitting the usual
      system low space threshold (measured as both a percentage and a byte count). So
      if <code>/data</code> is full, there won't be two copies of every .odex file.
      The same code also has a BULK_DELETE_THRESHOLD: If the device gets that close
      to filling the available space (as just described), the .odex files belonging to
      apps that aren't used are removed. That's another case without two copies of
      every .odex file.</p>

      <p>In the worst case where <code>/data</code> is completely full, the update
      waits until the device has rebooted into the new system and no longer needs the
      old system's .odex files. The PackageManager handles this:
      (<code><a href="https://android.googlesource.com/platform/frameworks/base/+/master/services/core/java/com/android/server/pm/PackageManagerService.java#7215" class="external">frameworks/base/+/master/services/core/java/com/android/server/pm/PackageManagerService.java#7215</a></code>).
      After the new system has successfully booted, <code>installd</code>
      (<code><a href="https://android.googlesource.com/platform/frameworks/native/+/master/cmds/installd/dexopt.cpp#2422" class="external">frameworks/native/+/master/cmds/installd/dexopt.cpp#2422</a></code>)
      can remove the .odex files that were used by the old system, returning the
      device back to the steady state where there's only one copy.</p>

      <p>So, while it is possible that <code>/data</code> contains two copies of all
      the .odex files, (a) this is temporary and (b) only occurs if you had plenty of
      free space on <code>/data</code> anyway. Except during an update, there's only
      one copy. And as part of ART's general robustness features, it will never fill
      <code>/data</code> with .odex files anyway (because that would be a problem on a
      non-A/B system too).</p>

      <h3>Doesn't all this writing/copying increase flash wear?</h3>

      <p>Only a small portion of flash is rewritten: a full Pixel system update
      writes about 2.3GiB. (Apps are also recompiled, but that's true of non-A/B
      too.) Traditionally, block-based full OTAs wrote a similar amount of data, so
      flash wear rates should be similar.</p>

      <h3>Does flashing two system partitions increase factory flashing time?</h3>

      <p>No. Pixel didn't increase in system image size (it merely divided the space
      across two partitions).</p>

      <h3>Doesn't keeping .odex files on B make rebooting after factory data reset
      slow?</h3>

      <p>Yes. If you've actually used a device, taken an OTA, and performed a factory
      data reset, the first reboot will be slower than it would otherwise be (1m40s vs
      40s on a Pixel XL) because the .odex files will have been lost from B after the
      first OTA and so can't be copied to <code>/data</code>. That's the trade-off.</p>

      <p>Factory data reset should be a rare operation when compared to regular boot
      so the time taken is less important. (This doesn't affect users or reviewers who
      get their device from the factory, because in that case the B partition is
      available.) Use of the JIT compiler means we don't need to recompile
      <em>everything</em>, so it's not as bad as you might think. It's also possible
      to mark apps as requiring ahead-of-time compilation using
      <code>coreApp="true"</code> in the manifest:
      (<code><a href="https://android.googlesource.com/platform/frameworks/base/+/master/packages/SystemUI/AndroidManifest.xml#23" class="external">frameworks/base/+/master/packages/SystemUI/AndroidManifest.xml#23</a></code>).
      This is currently used by <code>system_server</code> because it's not allowed to
      JIT for security reasons.</p>

      <h3>Doesn't keeping .odex files on /data rather than /system make rebooting
      after an OTA slow?</h3>

      <p>No. As explained above, the new dex2oat is run while the old system image is
      still running to generate the files that will be needed by the new system. The
      update isn't considered available until that work has been done.</p>

      <h3>Can (should) we ship a 32GiB A/B device? 16GiB? 8GiB?</h3>

      <p>32GiB works well as it was proven on Pixel, and 320MiB out of 16GiB means a
      reduction of 2%. Similarly, 320MiB out of 8GiB a reduction of 4%. Obviously
      A/B would not be the recommended choice on devices with 4GiB, as the 320MiB
      overhead is almost 10% of the total available space.</p>

      <h3>Does AVB2.0 require A/B OTAs?</h3>

      <p>No. Android <a href="../../../../security/verifiedboot/index-3.html">Verified Boot</a> has always
      required block-based updates, but not necessarily A/B updates.</p>

      <h3>Do A/B OTAs require AVB2.0?</h3>

      <p>No.</p>

      <h3>Do A/B OTAs break AVB2.0's rollback protection?</h3>

      <p>No. There's some confusion here because if an A/B system fails to boot into
      the new system image it will (after some number of retries determined by your
      bootloader) automatically revert to the "previous" system image. The key point
      here though is that "previous" in the A/B sense is actually still the "current"
      system image. As soon as the device successfully boots a new image, rollback
      protection kicks in and ensures that you can't go back. But until you've
      actually successfully booted the new image, rollback protection doesn't
      consider it to be the current system image.</p>

      <h3>If you're installing an update while the system is running, isn't that
      slow?</h3>

      <p>With non-A/B updates, the aim is to install the update as quickly as
      possible because the user is waiting and unable to use their device while the
      update is applied. With A/B updates, the opposite is true; because the user is
      still using their device, as little impact as possible is the goal, so the
      update is deliberately slow. Via logic in the Java system update client (which
      for Google is GmsCore, the core package provided by GMS), Android also attempts
      to choose a time when the users aren't using their devices at all. The platform
      supports pausing/resuming the update, and the client can use that to pause the
      update if the user starts to use the device and resume it when the device is
      idle again.</p>

      <p>There are two phases while taking an OTA, shown clearly in the UI as
      <em>Step 1 of 2</em> and <em>Step 2 of 2</em> under the progress bar. Step 1
      corresponds with writing the data blocks, while step 2 is pre-compiling the
      .dex files. These two phases are quite different in terms of performance
      impact. The first phase is simple I/O. This requires little in the way of
      resources (RAM, CPU, I/O) because it's just slowly copying blocks around.</p>

      <p>The second phase runs dex2oat to precompile the new system image. This
      obviously has less clear bounds on its requirements because it compiles actual
      apps. And there's obviously much more work involved in compiling a large and
      complex app than a small and simple app; whereas in phase 1 there are no disk
      blocks that are larger or more complex than others.</p>

      <p>The process is similar to when Google Play installs an app update in the
      background before showing the <em>5 apps updated</em> notification, as has been
      done for years.</p>

      <h3>What if a user is actually waiting for the update?</h3>

      <p>The current implementation in GmsCore doesn't distinguish between background
      updates and user-initiated updates but may do so in the future. In the case
      where the user explicitly asked for the update to be installed or is watching
      the update progress screen, we'll prioritize the update work on the assumption
      that they're actively waiting for it to finish.</p>

      <h3>What happens if there's a failure to apply an update?</h3>

      <p>With non-A/B updates, if an update failed to apply, the user was usually
      left with an unusable device. The only exception was if the failure occurred
      before an application had even started (because the package failed to verify,
      say). With A/B updates, a failure to apply an update does not affect the
      currently running system. The update can simply be retried later.</p>

      <h3>Which systems on a chip (SoCs) support A/B?</h3>

      <p>As of 2017-03-15, we have the following information:</p>
      <table class="style0">
      <tbody>
      <tr>
      <td></td>
      <td><strong>Android 7.x and earlier</strong></td>
      <td><strong>Android 8.x and later</strong></td>
      </tr>
      <tr>
      <td><strong>Qualcomm</strong></td>
      <td>Depending on OEM requests </td>
      <td>All chipsets will get support</td>
      </tr>
      <tr>
      <td><strong>Mediatek</strong></td>
      <td>Depending on OEM requests</td>
      <td>All chipsets will get support</td>
      </tr>
      </tbody>
      </table>

      <p>For details on schedules, check with your SoC contacts. For SoCs not listed
      above, reach out to your SoC directly.</p>

  
          </div>

    
                   <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
                   
          </article>
</article>

<devsite-content-footer ds-is="content-footer" class="nocontent">
  <p>Content and code samples on this page are subject to the licenses described in the <a href="../../../../license.html">Content License</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
</devsite-content-footer>


                      </devsite-content>
        </div>
        <devsite-footer-promos ds-is="footer-promos" class="devsite-footer">
                      
                  </devsite-footer-promos>
        <devsite-footer-linkboxes ds-is="footer-linkboxes" class="devsite-footer">
                      <nav class="devsite-footer-linkboxes nocontent">
  <ul class="devsite-footer-linkboxes-list">
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Build</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.googlesource.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android repository
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../../../../setup/build/requirements.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            Requirements
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../../../../setup/build/downloading.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Downloading
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/blobs-preview/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            Preview binaries
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/images/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Factory images
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/drivers/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Driver binaries
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.github.io/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            GitHub
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Connect</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/Android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            @Android on Twitter
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/AndroidDev/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            @AndroidDev on Twitter
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://blog.google/products/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Android Blog
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://security.googleblog.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            Google Security Blog
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-platform/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Platform on Google Groups
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-building/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Building on Google Groups
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-porting/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            Porting on Google Groups
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Get help</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/pixelphone/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            Pixel Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/nexus/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Nexus Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            www.android.com
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/gms/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Google Mobile Services
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://stackoverflow.com/questions/tagged/android-source/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Stack Overflow
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://issuetracker.google.com/issues?q=status:open%20componentid:190923"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            Issue Tracker
          </a>
        </li>
              </ul>
    </li>
      </ul>
</nav>
                  </devsite-footer-linkboxes>
        <devsite-footer-utility ds-is="footer-utility" class="devsite-footer">
                      <div class="devsite-footer-utility">
  
  <nav class="devsite-nav">
        <ul class="devsite-footer-utility-list">
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../../../source/index.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer About Android link">
          About Android
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../../../setup/community.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer Community link">
          Community
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../../../legal.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer Legal link">
          Legal
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../../../license.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer License link">
          License
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://policies.google.cn/privacy"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link">
          Privacy
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://issuetracker.google.com/issues/new?component=191476"
           data-category="Site-Wide Custom Events"
           data-label="Footer Site feedback link">
          Site feedback
        </a>
              </li>
          </ul>
    
        <form class="devsite-footer-utility-language">
      <select class="devsite-footer-utility-language-select"
              name="language"
              track-name="click"
              track-type="languageSelector">
                  <option value="en"
                  track-metadata-original-language="en"
                  track-metadata-selected-language="en"
                  track-name="changed"
                  track-type="languageSelector"
                  selected="selected">
            English
          </option>
                  <option value="zh_cn"
                  track-metadata-original-language="en"
                  track-metadata-selected-language="zh_cn"
                  track-name="changed"
                  track-type="languageSelector"
                  >
            
          </option>
              </select>
    </form>
      </nav>
</div>
                  </devsite-footer-utility>
      </div></div>
    <devsite-sitemask ds-is="site-mask"></devsite-sitemask>
    <devsite-snackbar ds-is="snackbar"                       ></devsite-snackbar>    <devsite-tooltip ds-is="tooltip"
                     blocked-link></devsite-tooltip>
    <devsite-analytics ds-is="analytics">
              <script type="application/json" analytics>[{"metrics": {"ratings_value": "metric1", "ratings_count": "metric2"}, "dimensions": {}, "gaid": "UA-45455297-4"}]</script>
<script type="application/json" gtm>[]</script>
          </devsite-analytics>
    <script>
    (function(d,e,v,E,l,o,p,r,s,_,__){d['GoogleDevelopersObject']=[!0,l,o,p,r,s];
    _=e.createElement(v);_.async=1;_.src=E;__=e.getElementsByTagName(v)[0];
    __.parentNode.insertBefore(_,__);})(window, document, 'script',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/js/app_loader.js',
      'en',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/js/devsite_app.js',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource',
      !1,
      ['/_pwa/androidsource/manifest.json',
       'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/images/video-placeholder.svg',
       'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/favicon.png','https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/lockup.svg','https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons'],
       'https://androidsource-dot-google-developers.gonglchuangl.net/')
   </script>  </body>

<!-- Mirrored from source.android.google.cn/devices/tech/ota/ab/ab_faqs.html by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Mar 2019 14:14:29 GMT -->
</html>