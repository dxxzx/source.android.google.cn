<!doctype html>
<html       lang="zh-CN"      dir="ltr">
  
<!-- Mirrored from source.android.google.cn/devices/camera?hl=zh-cn by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 09 Sep 2019 18:09:39 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
    <meta property="og:site_name" content="Android Open Source Project">
    <meta property="og:type" content="website">
    
          <meta name="theme-color" content="#78c257">
    
    <meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="../_pwa/androidsource/manifest.json"
          crossorigin="use-credentials">
    <link rel="preconnect" href="http://www.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.googleapis.com/" crossorigin>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons">
        <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/androidsource/css/rebrand-app.css">
    <noscript>
      <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/androidsource/css/ce_bundle.css">
    </noscript>
    <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/androidsource/images/rebrand/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/androidsource/images/rebrand/touchicon-180.png"><link rel="canonical" href="camera.html">      
<title>相机 &nbsp;|&nbsp; Android 开源项目 &nbsp;|&nbsp; Android Open Source Project</title>

<meta property="og:title" content="相机 &nbsp;|&nbsp; Android 开源项目 &nbsp;|&nbsp; Android Open Source Project">


  <meta property="og:url" content="camera.html">

  <meta property="og:locale" content="zh_cn">




    
    
    
  
    </head>
  <body type="article"
        theme="androidsource-theme"
        class=""
        
        layout="docs"
        block-apix        pending>
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
    <div class="devsite-wrapper"><devsite-header keep-tabs-visible>
      









<div class="devsite-header--inner">
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="Close menu">
        </button>
        <div class="devsite-product-name-wrapper">
  <a href="../index0b8e.html?hl=zh-cn" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo">
  <img src="https://www.gstatic.cn/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/androidsource/images/rebrand/lockup.svg" class="devsite-site-logo" alt="Android Open Source Project">
</a>
            <span class="devsite-product-name">
            <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item
             ">
                              </li>
  </ul>
          </span>
        
</div>        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
                          <devsite-tabs class="upper-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="../setup0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="设置"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 设置"
   >
  设置
</a>

        </tab>
                        <tab >
          <a href="../compatibility0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="设计"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 设计"
   >
  设计
</a>

        </tab>
                        <tab >
          <a href="../security0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="安全性"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 安全性"
   >
  安全性
</a>

        </tab>
                        <tab active>
          <a href="../devices0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="开发"
   aria-label="开发, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: 开发"
   >
  开发
</a>

        </tab>
                        <tab >
          <a href="tech0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="配置"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 配置"
   >
  配置
</a>

        </tab>
                        <tab >
          <a href="../reference0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="参考"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 参考"
   >
  参考
</a>

        </tab>
            </div>
</devsite-tabs>

                       </div>
          <devsite-search
            enable-suggestions
              family-name="Android 开源项目"    tenant-name="Android Open Source Project"            >
  <form class="devsite-search-form" action="https://source.android.google.cn/s/results?hl=zh-cn" method="GET">
    <div class="devsite-search-container">
      <div class="devsite-searchbox">
                <input placeholder="搜索"
          type="text"
          class="devsite-search-field devsite-search-query"
          name="q"
          value=""
          autocomplete="off"
                    aria-label="搜索框">
        <div class="devsite-search-image material-icons" aria-hidden="true"></div>
      </div>
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              aria-label="Open search box"></button>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          aria-label="Close search box"></button>
</devsite-search>

        </div>

        <devsite-language-selector>
  <devsite-select class="devsite-language-selector-menu">
    <select class="devsite-language-selector-select"
            name="language"
            track-name="click"
            track-type="languageSelector">
                <option>Language</option>
              <option value="en"
              track-metadata-original-language="zh_cn"
              track-metadata-selected-language="en"
              track-name="changed"
              track-type="languageSelector"
            >
        English
      </option>
          <option value="zh_cn"
              track-metadata-original-language="zh_cn"
              track-metadata-selected-language="zh_cn"
              track-name="changed"
              track-type="languageSelector"
            >
        中文 – 简体
      </option>
        </select>
  </devsite-select>
</devsite-language-selector>


                  <a class="devsite-header-link devsite-top-button button gc-analytics-event"
   href="http://android-review.googlesource.com/"
   data-category="Site-Wide Custom Events"
   data-label="Site header link">
  转到源代码
</a>
        
              </div>    </div>  </div>
  <div class="devsite-collapsible-section
    ">
    <div class="devsite-header-background">
                        <div class="devsite-product-id-row">
            <div class="devsite-product-description-row">
                              <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item
             ">
                    <a href="../devices0b8e.html?hl=zh-cn"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Lower Header"
              data-value="1"
          >
            开发
      
  </a>
        </li>
  </ul>
                                        </div>
                                                                                    </div>
                                      <div class="devsite-doc-set-nav-row">
                              <devsite-tabs class="lower-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="../devices0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="概览"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 概览"
   >
  概览
</a>

        </tab>
                        <tab >
          <a href="audio0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="音频"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 音频"
   >
  音频
</a>

        </tab>
                        <tab active>
          <a href="camera0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="相机"
   aria-label="相机, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: 相机"
   >
  相机
</a>

        </tab>
                        <tab >
          <a href="tech/connect0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="连接"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 连接"
   >
  连接
</a>

        </tab>
                        <tab >
          <a href="graphics0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="图形"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 图形"
   >
  图形
</a>

        </tab>
                        <tab >
          <a href="interaction0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="互动"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 互动"
   >
  互动
</a>

        </tab>
                        <tab >
          <a href="media0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="媒体"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 媒体"
   >
  媒体
</a>

        </tab>
                        <tab >
          <a href="storage0b8e.html?hl=zh-cn"
   class="gc-analytics-event"
   title="存储"
           data-category="Site-Wide Custom Events"
        data-label="Tab: 存储"
   >
  存储
</a>

        </tab>
            </div>
</devsite-tabs>

        </div>
          </div>  </div></div>
  

  </devsite-header>      <devsite-book-nav scrollbars >
                  




<nav class="devsite-book-nav devsite-nav nocontent">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="Close navigation">
    </button>
    <div class="devsite-product-name-wrapper">
  <a href="../index.html" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo">
  <img src="https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/androidsource/images/rebrand/lockup.svg" class="devsite-site-logo" alt="Android Open Source Project">
</a>
        <span class="devsite-product-name">
        <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item
             ">
                              </li>
  </ul>
      </span>
    
</div>  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
              <ul class="devsite-nav-list">
                      <li class="devsite-nav-item">
                                <a href="../setup.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 设置">
      <span class="devsite-nav-text" >设置</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../compatibility.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 设计">
      <span class="devsite-nav-text" >设计</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../security.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 安全性">
      <span class="devsite-nav-text" >安全性</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../devices.html"
          class="devsite-nav-title gc-analytics-event
            devsite-nav-active"
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 开发">
      <span class="devsite-nav-text" >开发</span>
        </a>
  
                                            <ul class="devsite-nav-responsive-tabs">
                                                                                                                      <li class="devsite-nav-item">
    <a href="../devices.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 概览">
      <span class="devsite-nav-text" >概览</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="audio.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 音频">
      <span class="devsite-nav-text" >音频</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="camera.html"
     id="devsite-nav-forward"     class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 相机">
      <span class="devsite-nav-text" menu="_book">相机</span>
        <span class="devsite-nav-icon material-icons" data-icon="forward" aria-hidden="true"
          menu="_book">
    </span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="tech/connect.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 连接">
      <span class="devsite-nav-text" >连接</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="graphics.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 图形">
      <span class="devsite-nav-text" >图形</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="interaction.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 互动">
      <span class="devsite-nav-text" >互动</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="media.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 媒体">
      <span class="devsite-nav-text" >媒体</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="storage.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 存储">
      <span class="devsite-nav-text" >存储</span>
        </a>
  </li>

                                  </ul>
                          </li>
                      <li class="devsite-nav-item">
                                <a href="tech.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 配置">
      <span class="devsite-nav-text" >配置</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../reference.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 参考">
      <span class="devsite-nav-text" >参考</span>
        </a>
  
                                        </li>
                                <li class="devsite-nav-item">
    <a href="http://android-review.googlesource.com/"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: 转到源代码">
      <span class="devsite-nav-text" >转到源代码</span>
        </a>
  </li>

                  </ul>
          </div>
          <div class="devsite-mobile-nav-bottom">
                            <ul class="devsite-nav-list" menu="_book">
            <li class="devsite-nav-item"><a href="camera.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="概览">概览</span></a></li>
  <li class="devsite-nav-item"><a href="camera/camera3.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Camera3">Camera3</span></a></li>
  <li class="devsite-nav-item"><a href="camera/camera3_requests_hal.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="HAL 子系统">HAL 子系统</span></a></li>
  <li class="devsite-nav-item"><a href="camera/camera3_metadata.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="元数据和控件">元数据和控件</span></a></li>
  <li class="devsite-nav-item"><a href="camera/camera3_3Amodes.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="3A 模式和状态">3A 模式和状态</span></a></li>
  <li class="devsite-nav-item"><a href="camera/camera3_crop_reprocess.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="输出和剪裁">输出和剪裁</span></a></li>
  <li class="devsite-nav-item"><a href="camera/camera3_error_stream.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="错误和数据流">错误和数据流</span></a></li>
  <li class="devsite-nav-item"><a href="camera/camera3_requests_methods.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="创建请求">创建请求</span></a></li>
  <li class="devsite-nav-item"><a href="camera/external-usb-cameras.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="外接 USB 摄像头">外接 USB 摄像头</span></a></li>
  <li class="devsite-nav-item"><a href="camera/multi-camera.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="多摄像头支持">多摄像头支持</span></a></li>
  <li class="devsite-nav-item"><a href="camera/motion-tracking.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="运动跟踪">运动跟踪</span></a></li>
  <li class="devsite-nav-item"><a href="camera/session-parameters.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="会话参数">会话参数</span></a></li>
  <li class="devsite-nav-item"><a href="camera/singleprod-multiconsum.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="单一生产方，多个消费方">单一生产方，多个消费方</span></a></li>
  <li class="devsite-nav-item"><a href="camera/versioning.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="版本支持">版本支持</span></a></li>
          </ul>
                                                                                                                                                                            </div>
      </div>
</nav>
              </devsite-book-nav>
      <div id="gc-wrapper">
        <div class="devsite-main-content"
            has-book-nav            has-toc>
          <devsite-toc class="devsite-nav"
            ></devsite-toc>
          <devsite-content>
                          

<article class="devsite-article">
  <article class="devsite-article-inner">        
    <div class="devsite-article-meta">
      <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item
             ">
                    <a href="../index0b8e.html?hl=zh-cn"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="1"
          >
            AOSP
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item
             ">
                <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
                    <a href="../devices0b8e.html?hl=zh-cn"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="2"
          >
            开发
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item
             ">
                <div class="devsite-breadcrumb-guillemet material-icons" aria-hidden="true"></div>
                    <a href="camera0b8e.html?hl=zh-cn"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="3"
          >
            相机
      
  </a>
        </li>
  </ul>
               <devsite-page-rating position="header" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
          </div>

              <h1 class="devsite-page-title">相机</h1>
    
    <devsite-toc class="devsite-nav" devsite-toc-embedded >
    </devsite-toc>

    <div class="devsite-article-body clearfix
      ">

              
  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

<img style="float: right; margin: 0px 15px 15px 15px;" src="camera/images/ape_fwk_hal_camera0b8e.png?hl=zh-cn" alt="Android 相机 HAL 图标"/>

<p>Android 的相机硬件抽象层 (HAL) 可将 <a href="http://developer.android.google.cn/reference/android/hardware/package-summary.html?hl=zh-cn">Camera 2</a> 中较高级别的相机框架 API 连接到底层的相机驱动程序和硬件。相机子系统包括相机管道组件的实现，而相机 HAL 则可提供用于实现您的这些组件版本的接口。</p>

<aside class="note"><strong>注意</strong>：如果您要在搭载 Android 8.0 或更高版本的设备上实现相机 HAL，则必须使用 HIDL 接口。要了解旧版组件，请参阅<a href="#architecture-legacy">旧版 HAL 组件</a>。</aside>

<h2 id="architecture">架构</h2>
<p>下列图表和列表说明了 HAL 组件：</p>

<img src="camera/images/ape_fwk_camera20b8e.png?hl=zh-cn" alt="Android 相机架构" id="figure1"/>
<p class="img-caption"><strong>图 1.</strong> 相机架构</p>

<dl>
  <dt>应用框架</dt>
  <dd>应用代码位于应用框架级别，它使用 <a href="https://developer.android.google.cn/reference/android/hardware/camera2/package-summary?hl=zh-cn">Camera 2</a> API 与相机硬件进行交互。在内部，这些代码会调用相应的 <a href="https://developer.android.google.cn/reference/android/os/Binder.html?hl=zh-cn">Binder</a> 接口，以访问与相机互动的原生代码。</dd>
  <dt>AIDL</dt>
  <dd>与 CameraService 关联的 Binder 接口可在 <a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/ICameraService.aidl">frameworks/av/camera/aidl/android/hardware</a> 中找到。生成的代码会调用较低级别的原生代码以获取对实体相机的访问权限，并返回用于在框架级别创建 <a href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraDevice?hl=zh-cn">CameraDevice</a> 并最终创建 <a href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraCaptureSession.html?hl=zh-cn">CameraCaptureSession</a> 对象的数据。</dd>
  <dt>原生框架</dt><dt>
  </dt><dd>此框架位于 <code>frameworks/av/</code> 中，并提供相当于 <a href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraDevice?hl=zh-cn">CameraDevice</a> 和 <a href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraCaptureSession?hl=zh-cn">CameraCaptureSession</a> 类的原生类。另请参阅 <a href="https://developer.android.google.cn/ndk/reference/group/camera?hl=zh-cn">NDK camera2 参考</a>。</dd>
  <dt>Binder IPC 接口</dt>
  <dd>IPC binder 接口用于实现跨越进程边界的通信。调用相机服务的若干个相机 Binder 类位于 <code>frameworks/av/camera/camera/aidl/android/hardware</code> 目录中。
  <a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/ICameraService.aidl">ICameraService</a> 是相机服务的接口；<a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/camera2/ICameraDeviceUser.aidl">ICameraDeviceUser</a> 是已打开的特定相机设备的接口；<a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/ICameraServiceListener.aidl">ICameraServiceListener</a> 和 <a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/camera2/ICameraDeviceCallbacks.aidl">ICameraDeviceCallbacks</a> 分别是对应用框架的 CameraService 和 CameraDevice 回调。</dd>
  <dt>相机服务</dt>
  <dd>位于 <code>frameworks/av/services/camera/libcameraservice/CameraService.cpp</code> 下的相机服务是与 HAL 进行互动的实际代码。</dd>
  <dt>HAL</dt>
  <dd>硬件抽象层定义了由相机服务调用、且您必须实现以确保相机硬件正常运行的标准接口。</dd>
</dl>

<h2 id="implementing">实现 HAL</h2>
<p>HAL 位于相机驱动程序和更高级别的 Android 框架之间，它定义您必须实现的接口，以便应用可以正确地操作相机硬件。从 Android 8.0 开始，相机 HAL 接口是 Project <a href="architecture/treble0b8e.html?hl=zh-cn">Treble</a> 的一部分，相应的 <a href="architecture/hidl/index0b8e.html?hl=zh-cn">HIDL</a> 接口在 <a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/">hardware/interfaces/camera</a> 中定义。</p>

<p>典型的绑定式 HAL 必须实现以下 HIDL 接口：</p>
<ul>
  <li><a href="../reference/hidl0b8e.html?hl=zh-cn">ICameraProvider</a>：用于枚举单个设备并管理其状态。</li>
  <li><a href="../reference/hidl0b8e.html?hl=zh-cn">ICameraDevice</a>：相机设备接口。</li>
  <li><a href="../reference/hidl0b8e.html?hl=zh-cn">ICameraDeviceSession</a>：活跃的相机设备会话接口。</li>
</ul>
<p>参考 HIDL 实现适用于 <a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/provider/2.4/default/CameraProvider.cpp">CameraProvider.cpp</a>、<a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/device/3.2/default/CameraDevice.cpp">CameraDevice.cpp</a> 和 <a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/device/3.2/default/CameraDeviceSession.cpp">CameraDeviceSession.cpp</a>。该实现封装了仍在使用<a href="https://android.googlesource.com/platform/hardware/libhardware/+/master/include/hardware/camera3.h">旧版 API</a> 的旧 HAL。从 Android 8.0 开始，相机 HAL 实现必须使用 HIDL API；不支持使用旧版接口。</p>

<p>要详细了解 Treble 和 HAL 开发，请参阅 <a href="architecture/treble0b8e.html?hl=zh-cn#treble-resources">Treble 资源</a>。</p>

<h2 id="legacy-hal">旧版 HAL 组件</h2>
<p>此部分介绍了旧版 HAL 组件的架构以及如何实现 HAL。搭载 Android 8.0 或更高版本的设备上的相机 HAL 实现必须改用 HIDL API（如上所述）。</p>

<h3 id="architecture-legacy">架构（旧版）</h3>

<p>下列图表和列表说明了旧版相机 HAL 组件：</p>

<img src="camera/images/ape_fwk_camera0b8e.png?hl=zh-cn" alt="Android 相机架构" id="figure1"/>
<p class="img-caption"><strong>图 1.</strong> 相机架构</p>

<dl>
  <dt>应用框架</dt>
  <dd>应用代码位于应用框架级别，它利用 <a href="http://developer.android.google.cn/reference/android/hardware/Camera.html?hl=zh-cn">android.hardware.Camera</a> API 与相机硬件进行交互。在内部，此代码会调用相应的 JNI 粘合类，以访问与相机互动的原生代码。</dd>
  <dt>JNI</dt>
  <dd>与 <a href="http://developer.android.google.cn/reference/android/hardware/Camera.html?hl=zh-cn">android.hardware.Camera</a> 关联的 JNI 代码位于 <code>frameworks/base/core/jni/android_hardware_Camera.cpp</code> 中。此代码会调用较低级别的原生代码以获取对实体相机的访问权限，并返回用于在框架级别创建 <a href="http://developer.android.google.cn/reference/android/hardware/Camera.html?hl=zh-cn">android.hardware.Camera</a> 对象的数据。</dd>
  <dt>原生框架</dt><dt>
  </dt><dd>在 <code>frameworks/av/camera/Camera.cpp</code> 中定义的原生框架可提供相当于 <a href="http://developer.android.google.cn/reference/android/hardware/Camera.html?hl=zh-cn">android.hardware.Camera</a> 类的原生类。此类会调用 IPC binder 代理，以获取对相机服务的访问权限。</dd>
  <dt>Binder IPC 代理</dt>
  <dd>IPC binder 代理用于促进跨越进程边界的通信。调用相机服务的 3 个相机 binder 类位于 <code>frameworks/av/camera</code> 目录中。ICameraService 是相机服务的接口，ICamera 是已打开的特定相机设备的接口，ICameraClient 是指回应用框架的设备接口。</dd>
  <dt>相机服务</dt>
  <dd>位于 <code>frameworks/av/services/camera/libcameraservice/CameraService.cpp</code> 下的相机服务是与 HAL 进行互动的实际代码。</dd>
  <dt>HAL</dt>
  <dd>硬件抽象层定义了由相机服务调用、且您必须实现以确保相机硬件正常运行的标准接口。</dd>
  <dt>内核驱动程序</dt>
  <dd>相机的驱动程序可与实际相机硬件以及您的 HAL 实现进行互动。相机和驱动程序必须支持 YV12 和 NV21 图像格式，以便在显示和视频录制时支持预览相机图像。</dd>
</dl>

<h3 id="implementing-legacy">实现 HAL（旧版）</h3>
<p>HAL 位于相机驱动程序和更高级别的 Android 框架之间，它定义您必须实现的接口，以便应用可以正确地操作相机硬件。HAL 接口在 <code>hardware/libhardware/include/hardware/camera.h</code> 和 <code>hardware/libhardware/include/hardware/camera_common.h</code> 标头文件中定义。
</p>

<p><code>camera_common.h</code> 定义 <code>camera_module</code>；这是一个标准结构，可用于获取有关相机的一般信息，例如相机 ID 和所有相机通用的属性（例如，摄像头是前置还是后置）。</p>

<p>
<code>camera.h</code> 包含与 <a href="http://developer.android.google.cn/reference/android/hardware/Camera.html?hl=zh-cn">android.hardware.Camera</a> 对应的代码。此标头文件会声明一个 <code>camera_device</code> 结构，该结构又反过来包含一个带函数指针（可实现 HAL 接口）的 <code>camera_device_ops</code> 结构。有关开发者可以设置的相机参数的文档，请参阅 <code>frameworks/av/include/camera/CameraParameters.h</code>。通过 HAL 中的 <code>int
(*set_parameters)(struct camera_device *, const char *parms)</code> 来设置这些参数以及指向的函数。</p>

<p>有关 HAL 实现的示例，请参阅 <code>hardware/ti/omap4xxx/camera</code> 中的 Galaxy Nexus HAL 实现。</p>

<h3 id="configuring">配置共享库</h3>
<p>设置 Android 编译系统，以将 HAL 实现正确打包到共享库中，并通过创建 <code>Android.mk</code> 文件将其复制到相应位置：</p>

<ol>
<li>创建一个 <code>device/&lt;company_name&gt;/&lt;device_name&gt;/camera</code> 目录以包含您库的源文件。</li>

<li>创建一个 <code>Android.mk</code> 文件来编译共享库。确保 Makefile 包含以下行：<pre class="devsite-click-to-copy">
LOCAL_MODULE := camera.&lt;device_name&gt;
LOCAL_MODULE_RELATIVE_PATH := hw
</pre>
<p>您的库必须命名为 <code>camera.&lt;device_name&gt;</code>（自动附加 <code>.so</code>），以便 Android 可以正确加载库。例如，请参阅 <code>hardware/ti/omap4xxx/Android.mk</code> 中的 Galaxy Nexus 相机的 Makefile。</p></li>

<li>使用您设备的 Makefile 复制 <code>frameworks/native/data/etc</code> 目录中的必要功能 XML 文件，以指定您的设备具有相机功能。例如，要指定您的设备具有相机闪光灯并可自动对焦，请在您设备的 <code>&lt;device&gt;/&lt;company_name&gt;/&lt;device_name&gt;/device.mk</code> Makefile 中添加以下行：<pre class="devsite-click-to-copy">
PRODUCT_COPY_FILES := \ ...

PRODUCT_COPY_FILES += \
frameworks/native/data/etc/android.hardware.camera.flash-autofocus.xml:system/etc/permissions/android.hardware.camera.flash-autofocus.xml \
</pre>
<p>有关设备 Makefile 的示例，请参阅 <code>device/samsung/tuna/device.mk</code>。</p></li>

<li>在 <code>device/&lt;company_name&gt;/&lt;device_name&gt;/media_profiles.xml</code> 和 <code>device/&lt;company_name&gt;/&lt;device_name&gt;/media_codecs.xml</code> XML 文件中声明您相机的媒体编解码器、格式和分辨率功能。如需了解详情，请参阅<a href="media/index0b8e-2.html?hl=zh-cn#expose">将编解码器展示给框架</a>。</li>

<li>在您设备的 <code>device/&lt;company_name&gt;/&lt;device_name&gt;/device.mk</code> Makefile 中添加以下行，以将 <code>media_profiles.xml</code> 和 <code>media_codecs.xml</code> 文件复制到相应位置：
<pre class="devsite-click-to-copy">
# media config xml file
PRODUCT_COPY_FILES += \
    &lt;device&gt;/&lt;company&gt;/&lt;device&gt;/media_profiles.xml:system/etc/media_profiles.xml

# media codec config xml file
PRODUCT_COPY_FILES += \
    &lt;device&gt;/&lt;company&gt;/&lt;device&gt;/media_codecs.xml:system/etc/media_codecs.xml
</pre></li>

<li>要将相机应用包含在设备的系统映像中，请在设备的 <code>device/&lt;company&gt;/&lt;device&gt;/device.mk</code> Makefile 中的 <code>PRODUCT_PACKAGES</code> 变量中指定该应用：
<pre class="devsite-click-to-copy">
PRODUCT_PACKAGES := \
Gallery2 \
...
</pre></li>
</ol>


          </div>

    
                   <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
                   
          </article>
</article>

<devsite-content-footer class="nocontent">
  <p>Content and code samples on this page are subject to the licenses described in the <a href="../license0b8e.html?hl=zh-cn">Content License</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
</devsite-content-footer>


                      </devsite-content>
        </div>
        <devsite-footer-promos class="devsite-footer">
                      
                  </devsite-footer-promos>
        <devsite-footer-linkboxes class="devsite-footer">
                      <nav class="devsite-footer-linkboxes nocontent">
  <ul class="devsite-footer-linkboxes-list">
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">构建</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.googlesource.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android 代码库
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../setup/build/requirements.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            要求
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../setup/build/downloading.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            下载
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/blobs-preview/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            预览二进制文件
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/images/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            出厂映像
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/drivers/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            驱动程序二进制文件
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.github.io/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            GitHub
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">关注</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/Android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            在 Twitter 上 @Android
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/AndroidDev/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            在 Twitter 上 @AndroidDev
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://blog.google/products/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Android 博客
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://security.googleblog.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            Google 安全博客
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-platform/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Google 网上论坛上的 Android 平台论坛
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-building/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Google 网上论坛上的 Android 构建论坛
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-porting/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            Google 网上论坛上的 Android 移植论坛
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">获取帮助</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android 帮助中心
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/pixelphone/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            Pixel 帮助中心
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/nexus/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Nexus 帮助中心
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            www.android.com
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/gms/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Google Mobile Services
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://stackoverflow.com/questions/tagged/android-source/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Stack Overflow
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://issuetracker.google.com/issues?q=status:open%20componentid:190923"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            问题跟踪器
          </a>
        </li>
              </ul>
    </li>
      </ul>
</nav>
                  </devsite-footer-linkboxes>
        <devsite-footer-utility class="devsite-footer">
                      
<div class="devsite-footer-utility">
  
  <nav class="devsite-nav">
        <ul class="devsite-footer-utility-list">
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../source/index0b8e.html?hl=zh-cn"
           data-category="Site-Wide Custom Events"
           data-label="Footer About Android link">
          关于 Android
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../source/community0b8e.html?hl=zh-cn"
           data-category="Site-Wide Custom Events"
           data-label="Footer Community link">
          社区
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../legal0b8e.html?hl=zh-cn"
           data-category="Site-Wide Custom Events"
           data-label="Footer Legal link">
          法律条款
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../license0b8e.html?hl=zh-cn"
           data-category="Site-Wide Custom Events"
           data-label="Footer License link">
          许可
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://policies.google.cn/privacy?hl=zh-cn"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link">
          隐私权政策
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://issuetracker.google.com/issues/new?component=191476&amp;hl=zh-cn"
           data-category="Site-Wide Custom Events"
           data-label="Footer Site feedback link">
          网站反馈
        </a>
              </li>
          </ul>
    
    <devsite-language-selector>
  <devsite-select class="devsite-language-selector-menu">
    <select class="devsite-language-selector-select"
            name="language"
            track-name="click"
            track-type="languageSelector">
                <option>Language</option>
              <option value="en"
              track-metadata-original-language="zh_cn"
              track-metadata-selected-language="en"
              track-name="changed"
              track-type="languageSelector"
            >
        English
      </option>
          <option value="zh_cn"
              track-metadata-original-language="zh_cn"
              track-metadata-selected-language="zh_cn"
              track-name="changed"
              track-type="languageSelector"
            >
        中文 – 简体
      </option>
        </select>
  </devsite-select>
</devsite-language-selector>

  </nav>
</div>
                  </devsite-footer-utility>
      </div></div>
    <devsite-sitemask></devsite-sitemask>
    <devsite-snackbar                   ></devsite-snackbar>    <devsite-tooltip blocked-link></devsite-tooltip>
    <devsite-analytics>
              <script type="application/json" analytics>[{"metrics": {"ratings_value": "metric1", "ratings_count": "metric2"}, "dimensions": {}, "gaid": "UA-45455297-4"}]</script>
<script type="application/json" gtm>[]</script>
          </devsite-analytics>
        <script>
    (function(d,e,v,s,i,t,E){d['GoogleDevelopersObject']=i;
    t=e.createElement(v);t.async=1;t.src=s;E=e.getElementsByTagName(v)[0];
    E.parentNode.insertBefore(t,E);})(window, document, 'script',
    'https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/js/app_loader.js', '[7,"zh_cn",null,"../js/devsite_app.html","https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54","https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/androidsource","https://androidsource-dot-google-developers.gonglchuangl.net/",1,null,["/_pwa/androidsource/manifest.json","https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/images/video-placeholder.svg","https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/androidsource/images/rebrand/favicon.png","https://www.gstatic.com/devrel-devsite/vbb62cc5a3e8f17e37bae4792b437f28f787df3f9cf9732cbfcc99b4f4ff41a54/androidsource/images/rebrand/lockup.svg","https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons"]]')
  </script>  </body>

<!-- Mirrored from source.android.google.cn/devices/camera?hl=zh-cn by HTTrack Website Copier/3.x [XR&CO'2014], Mon, 09 Sep 2019 18:09:50 GMT -->
</html>