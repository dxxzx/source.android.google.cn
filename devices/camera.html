<!doctype html>
<html  lang="en">
  
<!-- Mirrored from source.android.google.cn/devices/camera by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Mar 2019 13:30:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
          
<title>Camera &nbsp;|&nbsp; Android Open Source Project</title>

<meta property="og:title" content="Camera &nbsp;|&nbsp; Android Open Source Project">

  <meta property="og:url" content="camera.html">

  <meta property="og:locale" content="en">


    
    
    
  
        <meta property="og:site_name" content="Android Open Source Project">
    <meta property="og:type" content="website">
    
          <meta name="theme-color" content="#78c257">
    
    <meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="../_pwa/androidsource/manifest.json">
    <link rel="preconnect" href="http://www.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.googleapis.com/" crossorigin>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons">
    <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/css/app.css">
    <noscript>
      <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/css/ce_bundle.css">
    </noscript>
    <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/touchicon-180.png"><link rel="canonical" href="camera.html"></head>
  <body type="article"
        theme="androidsource-theme"
        class=""
        
        layout="docs"
        pending>
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
    <div class="devsite-wrapper"><devsite-header ds-is="header" keep-tabs-visible>
      








<div class="devsite-header--inner">
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="Close menu">
        </button>
        <div class="devsite-product-name-wrapper">
  <a href="../index.html" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo">
  <img src="https://www.gstatic.cn/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/lockup.svg" class="devsite-site-logo" alt="Android Open Source Project">
</a>
            <span class="devsite-product-name">
            <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                              </li>
  </ul>
          </span>
        
</div>        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
                          <devsite-tabs ds-is="tabs" class="upper-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="../setup.html"
   class="gc-analytics-event"
   title="Set up"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Set up"
   >
  Set up
</a>

        </tab>
                        <tab >
          <a href="../compatibility.html"
   class="gc-analytics-event"
   title="Design"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Design"
   >
  Design
</a>

        </tab>
                        <tab >
          <a href="../security.html"
   class="gc-analytics-event"
   title="Secure"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Secure"
   >
  Secure
</a>

        </tab>
                        <tab active>
          <a href="audio.html"
   class="gc-analytics-event"
   title="Develop"
   aria-label="Develop, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: Develop"
   >
  Develop
</a>

        </tab>
                        <tab >
          <a href="tech/dalvik.html"
   class="gc-analytics-event"
   title="Configure"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Configure"
   >
  Configure
</a>

        </tab>
                        <tab >
          <a href="../reference.html"
   class="gc-analytics-event"
   title="Reference"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Reference"
   >
  Reference
</a>

        </tab>
            </div>
</devsite-tabs>

                       </div>
          <devsite-search ds-is="search"
            enable-suggestions
                  project-path="">
  <form class="devsite-search-form" action="https://source.android.google.cn/s/results/" method="GET">
    <div class="devsite-search-container">
      <div id="searchbox" class="devsite-searchbox">
                <input placeholder="Search"
          type="text"
          class="devsite-search-field devsite-search-query"
          name="q"
          value=""
          autocomplete="off"
                    aria-label="Search box">
        <div class="devsite-search-image material-icons"></div>
      </div>
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              aria-label="Open search box"></button>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          aria-label="Close search box"></button>
</devsite-search>

        </div>

                <a class="devsite-header-link devsite-top-button button gc-analytics-event"
           href="http://android-review.googlesource.com/"
           data-category="Site-Wide Custom Events"
           data-label="Site header link">
          Go to code
        </a>
                      </div>    </div>  </div>
  <div class="devsite-collapsible-section
    ">
    <div class="devsite-header-background">
                        <div class="devsite-product-id-row">
            <div class="devsite-product-description-row">
                              <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                    <a href="audio.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Lower Header"
              data-value="1"
          >
            Develop
      
  </a>
        </li>
  </ul>
                                        </div>
                                                                                    </div>
                                      <div class="devsite-doc-set-nav-row">
                              <devsite-tabs ds-is="tabs" class="lower-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="audio.html"
   class="gc-analytics-event"
   title="Audio"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Audio"
   >
  Audio
</a>

        </tab>
                        <tab active>
          <a href="camera.html"
   class="gc-analytics-event"
   title="Camera"
   aria-label="Camera, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: Camera"
   >
  Camera
</a>

        </tab>
                        <tab >
          <a href="tech/connect.html"
   class="gc-analytics-event"
   title="Connectivity"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Connectivity"
   >
  Connectivity
</a>

        </tab>
                        <tab >
          <a href="graphics.html"
   class="gc-analytics-event"
   title="Graphics"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Graphics"
   >
  Graphics
</a>

        </tab>
                        <tab >
          <a href="input.html"
   class="gc-analytics-event"
   title="Interaction"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Interaction"
   >
  Interaction
</a>

        </tab>
                        <tab >
          <a href="media.html"
   class="gc-analytics-event"
   title="Media"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Media"
   >
  Media
</a>

        </tab>
                        <tab >
          <a href="storage.html"
   class="gc-analytics-event"
   title="Storage"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Storage"
   >
  Storage
</a>

        </tab>
            </div>
</devsite-tabs>

        </div>
          </div>  </div></div>
  

  </devsite-header>      <devsite-book-nav ds-is="book-nav" scrollbars >
                  

<nav class="devsite-book-nav devsite-nav nocontent">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="Close navigation">
    </button>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
              <ul class="devsite-nav-list">
                      <li class="devsite-nav-item">
                                <a href="../setup.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Set up">
      <span class="devsite-nav-text" >Set up</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../compatibility.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Design">
      <span class="devsite-nav-text" >Design</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../security.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Secure">
      <span class="devsite-nav-text" >Secure</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="audio.html"
          class="devsite-nav-title gc-analytics-event
            devsite-nav-active"
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Develop">
      <span class="devsite-nav-text" >Develop</span>
        </a>
  
                                            <ul class="devsite-nav-responsive-tabs">
                                                                                                                      <li class="devsite-nav-item">
    <a href="audio.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Audio">
      <span class="devsite-nav-text" >Audio</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="camera.html"
     id="devsite-nav-forward"     class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Camera">
      <span class="devsite-nav-text" menu="_book">Camera</span>
        <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="_book">
    </span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="tech/connect.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Connectivity">
      <span class="devsite-nav-text" >Connectivity</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="graphics.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Graphics">
      <span class="devsite-nav-text" >Graphics</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="input.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Interaction">
      <span class="devsite-nav-text" >Interaction</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="media.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Media">
      <span class="devsite-nav-text" >Media</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="storage.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Storage">
      <span class="devsite-nav-text" >Storage</span>
        </a>
  </li>

                                  </ul>
                          </li>
                      <li class="devsite-nav-item">
                                <a href="tech/dalvik.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Configure">
      <span class="devsite-nav-text" >Configure</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../reference.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Reference">
      <span class="devsite-nav-text" >Reference</span>
        </a>
  
                                        </li>
                                <li class="devsite-nav-item">
    <a href="http://android-review.googlesource.com/"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Go to code">
      <span class="devsite-nav-text" >Go to code</span>
        </a>
  </li>

                  </ul>
          </div>
          <div class="devsite-mobile-nav-bottom">
                                      <ul class="devsite-nav-list" menu="_book">
                                    <li class="devsite-nav-item"><a href="camera.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/camera3.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Camera3">Camera3</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/camera3_requests_hal.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="HAL Subsystem">HAL Subsystem</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/camera3_metadata.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Metadata and Controls">Metadata and Controls</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/camera3_3Amodes.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="3A Modes and State">3A Modes and State</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/camera3_crop_reprocess.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Output and Cropping">Output and Cropping</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/camera3_error_stream.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Errors and Streams">Errors and Streams</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/camera3_requests_methods.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Request Creation">Request Creation</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/external-usb-cameras.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="External USB Cameras">External USB Cameras</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/multi-camera.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Multi-Camera Support">Multi-Camera Support</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/motion-tracking.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Motion Tracking">Motion Tracking</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/session-parameters.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Session Parameters">Session Parameters</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/singleprod-multiconsum.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Single Producer, Multiple Consumer">Single Producer, Multiple Consumer</span></a></li>
                          <li class="devsite-nav-item"><a href="camera/versioning-2.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Version Support">Version Support</span></a></li>
                      </ul>
                                                                                                                                                                            </div>
      </div>
</nav>
              </devsite-book-nav>
      <div id="gc-wrapper">
        <div class="devsite-main-content"
            has-book-nav            has-toc>
          <devsite-toc ds-is="toc" class="devsite-nav"
            ></devsite-toc>
          <devsite-content ds-is="content">
                          

<article class="devsite-article">
  <article class="devsite-article-inner">    
    <div class="devsite-article-meta">
      <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                    <a href="../index.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="1"
          >
            AOSP
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item">
                <div class="devsite-breadcrumb-guillemet material-icons"></div>
                    <a href="audio.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="2"
          >
            Develop
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item">
                <div class="devsite-breadcrumb-guillemet material-icons"></div>
                    <a href="camera.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="3"
          >
            Camera
      
  </a>
        </li>
  </ul>
               <devsite-page-rating position="header" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
          </div>

              <h1 class="devsite-page-title">Camera</h1>
    
    <devsite-toc ds-is="toc" class="devsite-nav" devsite-toc-embedded
                 ></devsite-toc>

    <div class="devsite-article-body clearfix
      ">

              
  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

<img style="float: right; margin: 0px 15px 15px 15px;" src="camera/images/ape_fwk_hal_camera.png" alt="Android Camera HAL icon"/>

<p>Android's camera Hardware Abstraction Layer (HAL) connects the higher level
camera framework APIs in
<a href="http://developer.android.google.cn/reference/android/hardware/package-summary.html">Camera 2</a>
to your underlying camera driver and hardware. The camera subsystem includes
implementations for camera pipeline components while the camera HAL provides
interfaces for use in implementing your version of these components.</p>

<aside class="note"><strong>Note:</strong> If you are implementing the Camera
  HAL on Android 8.0 and higher, you must use the HIDL interface. For
  information on the legacy components, see
  <a href="#architecture-legacy">Legacy HAL components</a>.</aside>

<h2 id="architecture">Architecture</h2>
<p>The following figure and list describe the HAL components:</p>

<img src="camera/images/ape_fwk_camera2.png" alt="Android camera architecture" id="figure1" />
<p class="img-caption"><strong>Figure 1.</strong> Camera architecture</p>

<dl>
  <dt>Application framework</dt>
  <dd>At the application framework level is the app's code, which uses the
  <a href="https://developer.android.google.cn/reference/android/hardware/camera2/package-summary">
  Camera 2</a>
  API to interact with the camera hardware. Internally, this code calls
  corresponding <a href="https://developer.android.google.cn/reference/android/os/Binder.html">Binder</a>
  interfaces to access the native code that interacts with the camera.</dd>
  <dt>AIDL</dt>
  <dd>The binder interface associated with CameraService can be found at
  <a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/ICameraService.aidl">frameworks/av/camera/aidl/android/hardware</a>.
  The generated code calls the lower level native code to obtain access to the
  physical camera and returns data that is used to create the
  <a href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraDevice">
  CameraDevice</a> and eventually
  <a href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraCaptureSession.html">CameraCaptureSession</a>
  objects at the framework level.</dd>
  <dt>Native framework<dt>
  <dd>This framework residing in <code>frameworks/av/</code> provides a
  native equivalent to the
  <a href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraDevice">CameraDevice</a>
  and
  <a href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraCaptureSession">CameraCaptureSession</a>
  classes. See also, <a href="https://developer.android.google.cn/ndk/reference/group/camera">
    NDK camera2 reference</a>.</dd>
  <dt>Binder IPC interface</dt>
  <dd>The IPC binder interface facilitates communication over process boundaries.
  There are several camera binder classes located in the
  <code>frameworks/av/camera/camera/aidl/android/hardware</code> directory that
  call into camera service.
  <a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/ICameraService.aidl">ICameraService</a>
  is the interface to the camera service;
  <a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/camera2/ICameraDeviceUser.aidl">ICameraDeviceUser</a>
  is the interface to a specific opened camera device; and
  <a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/ICameraServiceListener.aidl">ICameraServiceListener</a>
  and
  <a href="https://android.googlesource.com/platform/frameworks/av/+/master/camera/aidl/android/hardware/camera2/ICameraDeviceCallbacks.aidl">ICameraDeviceCallbacks</a>
  are the respective CameraService and CameraDevice callbacks to the application
  framework.</dd>
  <dt>Camera service</dt>
  <dd>The camera service, located in
  <code>frameworks/av/services/camera/libcameraservice/CameraService.cpp</code>,
  is the actual code that interacts with the HAL.</dd>
  <dt>HAL</dt>
  <dd>The hardware abstraction layer defines the standard interface that the
  camera service calls into and that you must implement to have your camera
  hardware function correctly.</dd>
</dl>

<h2 id="implementing">Implementing the HAL</h2>
<p>The HAL sits between the camera driver and the higher level Android framework
and defines an interface you must implement so apps can correctly operate the
camera hardware. From Android 8.0, the Camera HAL interface is part of Project
<a href="architecture.html">Treble</a> and the corresponding
<a href="architecture/hidl/index.html">HIDL</a> interfaces are defined in
<a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/">hardware/interfaces/camera</a>.</p>

<p>A typical binderized HAL must implement the following HIDL interfaces:</p>
<ul>
  <li><a href="../reference/hidl/android/hardware/camera/provider/2.4/ICameraProvider.html">ICameraProvider</a>:
  For enumerating individual devices and managing their status.</li>
  <li><a href="../reference/hidl/android/hardware/camera/device/3.2/ICameraDevice.html">ICameraDevice</a>:
  The camera device interface.</li>
  <li><a href="../reference/hidl/android/hardware/camera/device/3.2/ICameraDeviceSession.html">ICameraDeviceSession</a>:
  The active camera device session interface.</li>
</ul>
<p>Reference HIDL implementations are available for
<a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/provider/2.4/default/CameraProvider.cpp">CameraProvider.cpp</a>,
<a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/device/3.2/default/CameraDevice.cpp">CameraDevice.cpp</a>
and
<a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/device/3.2/default/CameraDeviceSession.cpp">CameraDeviceSession.cpp</a>.
The implementation wraps old HALs that still use the
<a href="https://android.googlesource.com/platform/hardware/libhardware/+/master/include/hardware/camera3.h">legacy API</a>.
Starting with Android 8.0, Camera HAL implementations must use the HIDL API; use
of the legacy interface is not supported.</p>

<p>For more information on Treble and HAL development, see
<a href="architecture.html#treble-resources">Treble Resources</a>.</p>

<h2 id="legacy-hal">Legacy HAL components</h2>
<p>This section describes the architecture of the legacy HAL components and how to
implement the HAL. Camera HAL implementations on Android 8.0 and higher must use
the HIDL API instead, described above.</p>

<h3 id="architecture-legacy">Architecture (legacy)</h3>

<p>The following figure and list describe the legacy camera HAL components:</p>

<img src="camera/images/ape_fwk_camera.png" alt="Android camera architecture" id="figure1" />
<p class="img-caption"><strong>Figure 1.</strong> Camera architecture</p>

<dl>
  <dt>Application framework</dt>
  <dd>At the application framework level is the app's code, which utilizes the
  <a href="http://developer.android.google.cn/reference/android/hardware/Camera.html">android.hardware.Camera</a>
  API to interact with the camera hardware. Internally, this code calls a
  corresponding JNI glue class to access the native code that interacts with the
  camera.</dd>
  <dt>JNI</dt>
  <dd>The JNI code associated with <a href="http://developer.android.google.cn/reference/android/hardware/Camera.html">android.hardware.Camera</a>
  is located in
  <code>frameworks/base/core/jni/android_hardware_Camera.cpp</code>. This code
  calls the lower level native code to obtain access to the physical camera
  and returns data that is used to create the
  <a href="http://developer.android.google.cn/reference/android/hardware/Camera.html">android.hardware.Camera</a>
  object at the framework level.</dd>
  <dt>Native framework<dt>
  <dd>The native framework defined in <code>frameworks/av/camera/Camera.cpp</code>
  provides a native equivalent to the
  <a href="http://developer.android.google.cn/reference/android/hardware/Camera.html">android.hardware.Camera</a>
  class. This class calls the IPC binder proxies to obtain access to the camera
  service.</dd>
  <dt>Binder IPC proxies</dt>
  <dd>The IPC binder proxies facilitate communication over process boundaries.
  There are three camera binder classes that are located in
  <code>frameworks/av/camera</code> directory that calls into camera service.
  ICameraService is the interface to the camera service, ICamera is the
  interface to a specific opened camera device, and ICameraClient is the
  device's interface back to the application framework.</dd>
  <dt>Camera service</dt>
  <dd>The camera service, located in
  <code>frameworks/av/services/camera/libcameraservice/CameraService.cpp</code>,
  is the actual code that interacts with the HAL.</dd>
  <dt>HAL</dt>
  <dd>The hardware abstraction layer defines the standard interface that the
  camera service calls into and that you must implement to have your camera
  hardware function correctly.</dd>
  <dt>Kernel driver</dt>
  <dd>The camera's driver interacts with the actual camera hardware and your
  implementation of the HAL. The camera and driver must support YV12 and NV21
  image formats to provide support for previewing the camera image on the
  display and video recording.</dd>
</dl>

<h3 id="implementing-legacy">Implementing the HAL (legacy)</h3>
<p>The HAL sits between the camera driver and the higher level Android framework
and defines an interface you must implement so apps can correctly operate the
camera hardware. The HAL interface is defined in the
<code>hardware/libhardware/include/hardware/camera.h</code> and
<code>hardware/libhardware/include/hardware/camera_common.h</code> header files.
</p>

<p><code>camera_common.h</code> defines <code>camera_module</code>, a standard
structure to obtain general information about the camera, such as the camera ID
and properties common to all cameras (i.e., whether it is a front- or
back-facing camera).</p>

<p>
<code>camera.h</code> contains code that corresponds to
<a href="http://developer.android.google.cn/reference/android/hardware/Camera.html">android.hardware.Camera</a>. This header file declares a
<code>camera_device</code> struct that in turn contains a
<code>camera_device_ops</code> struct with pointers to functions that implement
the HAL interface. For documentation on the camera parameters developers can
set, refer to <code>frameworks/av/include/camera/CameraParameters.h</code>.
These parameters are set with the function pointed to by <code>int
(*set_parameters)(struct camera_device *, const char *parms)</code> in the HAL.
</p>

<p>For an example of a HAL implementation, refer to the implementation for the
Galaxy Nexus HAL in <code>hardware/ti/omap4xxx/camera</code>.</p>


<h3 id="configuring">Configuring the shared library</h3>
<p>Set up the Android build system to correctly package the HAL implementation
into a shared library and copy it to the appropriate location by creating an
<code>Android.mk</code> file:</p>

<ol>
<li>Create a <code>device/&lt;company_name&gt;/&lt;device_name&gt;/camera</code>
directory to contain your library's source files.</li>

<li>Create an <code>Android.mk</code> file to build the shared library. Ensure
the Makefile contains the following lines:
<pre class="devsite-click-to-copy">
LOCAL_MODULE := camera.&lt;device_name&gt;
LOCAL_MODULE_RELATIVE_PATH := hw
</pre>
<p>Your library must be named <code>camera.&lt;device_name&gt;</code>
(<code>.so</code> is appended automatically), so Android can correctly load the
library. For an example, see the Makefile for the Galaxy Nexus camera located in
<code>hardware/ti/omap4xxx/Android.mk</code>.</p></li>

<li>Specify your device has camera features by copying the necessary feature XML
files in the <code>frameworks/native/data/etc</code> directory with your
device's Makefile. For example, to specify your device has a camera flash and
can autofocus, add the following lines in your device's
<code>&lt;device&gt;/&lt;company_name&gt;/&lt;device_name&gt;/device.mk</code>
Makefile:
<pre class="devsite-click-to-copy">
PRODUCT_COPY_FILES := \ ...

PRODUCT_COPY_FILES += \
frameworks/native/data/etc/android.hardware.camera.flash-autofocus.xml:system/etc/permissions/android.hardware.camera.flash-autofocus.xml \
</pre>
<p>For an example of a device Makefile, see
<code>device/samsung/tuna/device.mk</code>.</p></li>

<li>Declare your camera’s media codec, format, and resolution capabilities in
<code>device/&lt;company_name&gt;/&lt;device_name&gt;/media_profiles.xml</code>
and <code>device/&lt;company_name&gt;/&lt;device_name&gt;/media_codecs.xml</code>
XML files. For details, see
<a href="media/index.html#expose">Exposing codecs to the
framework</a>.</li>

<li>Add the following lines in your device's
<code>device/&lt;company_name&gt;/&lt;device_name&gt;/device.mk</code> Makefile
to copy the <code>media_profiles.xml</code> and <code>media_codecs.xml</code>
files to the appropriate location:
<pre class="devsite-click-to-copy">
# media config xml file
PRODUCT_COPY_FILES += \
    &lt;device&gt;/&lt;company&gt;/&lt;device&gt;/media_profiles.xml:system/etc/media_profiles.xml

# media codec config xml file
PRODUCT_COPY_FILES += \
    &lt;device&gt;/&lt;company&gt;/&lt;device&gt;/media_codecs.xml:system/etc/media_codecs.xml
</pre></li>

<li>To include the Camera app in your device's system image, specify it in the
<code>PRODUCT_PACKAGES</code> variable in your device's
<code>device/&lt;company&gt;/&lt;device&gt;/device.mk</code>
Makefile:
<pre class="devsite-click-to-copy">
PRODUCT_PACKAGES := \
Gallery2 \
...
</pre></li>
</ol>

  
          </div>

    
                   <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
                   
          </article>
</article>

<devsite-content-footer ds-is="content-footer" class="nocontent">
  <p>Content and code samples on this page are subject to the licenses described in the <a href="../license.html">Content License</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
</devsite-content-footer>


                      </devsite-content>
        </div>
        <devsite-footer-promos ds-is="footer-promos" class="devsite-footer">
                      
                  </devsite-footer-promos>
        <devsite-footer-linkboxes ds-is="footer-linkboxes" class="devsite-footer">
                      <nav class="devsite-footer-linkboxes nocontent">
  <ul class="devsite-footer-linkboxes-list">
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Build</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.googlesource.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android repository
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../setup/build/requirements.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            Requirements
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../setup/build/downloading.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Downloading
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/blobs-preview/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            Preview binaries
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/images/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Factory images
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/drivers/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Driver binaries
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.github.io/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            GitHub
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Connect</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/Android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            @Android on Twitter
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/AndroidDev/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            @AndroidDev on Twitter
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://blog.google/products/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Android Blog
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://security.googleblog.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            Google Security Blog
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-platform/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Platform on Google Groups
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-building/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Building on Google Groups
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-porting/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            Porting on Google Groups
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Get help</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/pixelphone/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            Pixel Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/nexus/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Nexus Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            www.android.com
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/gms/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Google Mobile Services
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://stackoverflow.com/questions/tagged/android-source/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Stack Overflow
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://issuetracker.google.com/issues?q=status:open%20componentid:190923"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            Issue Tracker
          </a>
        </li>
              </ul>
    </li>
      </ul>
</nav>
                  </devsite-footer-linkboxes>
        <devsite-footer-utility ds-is="footer-utility" class="devsite-footer">
                      <div class="devsite-footer-utility">
  
  <nav class="devsite-nav">
        <ul class="devsite-footer-utility-list">
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../source/index.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer About Android link">
          About Android
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../setup/community.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer Community link">
          Community
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../legal.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer Legal link">
          Legal
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../license.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer License link">
          License
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://policies.google.cn/privacy"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link">
          Privacy
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://issuetracker.google.com/issues/new?component=191476"
           data-category="Site-Wide Custom Events"
           data-label="Footer Site feedback link">
          Site feedback
        </a>
              </li>
          </ul>
    
        <form class="devsite-footer-utility-language">
      <select class="devsite-footer-utility-language-select"
              name="language"
              track-name="click"
              track-type="languageSelector">
                  <option value="en"
                  track-metadata-original-language="en"
                  track-metadata-selected-language="en"
                  track-name="changed"
                  track-type="languageSelector"
                  selected="selected">
            English
          </option>
                  <option value="zh_cn"
                  track-metadata-original-language="en"
                  track-metadata-selected-language="zh_cn"
                  track-name="changed"
                  track-type="languageSelector"
                  >
            简体中文
          </option>
              </select>
    </form>
      </nav>
</div>
                  </devsite-footer-utility>
      </div></div>
    <devsite-sitemask ds-is="site-mask"></devsite-sitemask>
    <devsite-snackbar ds-is="snackbar"                       ></devsite-snackbar>    <devsite-tooltip ds-is="tooltip"
                     blocked-link></devsite-tooltip>
    <devsite-analytics ds-is="analytics">
              <script type="application/json" analytics>[{"metrics": {"ratings_value": "metric1", "ratings_count": "metric2"}, "dimensions": {}, "gaid": "UA-45455297-4"}]</script>
<script type="application/json" gtm>[]</script>
          </devsite-analytics>
    <script>
    (function(d,e,v,E,l,o,p,r,s,_,__){d['GoogleDevelopersObject']=[!0,l,o,p,r,s];
    _=e.createElement(v);_.async=1;_.src=E;__=e.getElementsByTagName(v)[0];
    __.parentNode.insertBefore(_,__);})(window, document, 'script',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/js/app_loader.js',
      'en',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/js/devsite_app.js',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource',
      !0,
      ['/_pwa/androidsource/manifest.json',
       'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/images/video-placeholder.svg',
       'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/favicon.png','https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/lockup.svg','https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons'],
       'https://androidsource-dot-google-developers.gonglchuangl.net/')
   </script>  </body>

<!-- Mirrored from source.android.google.cn/devices/camera by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Mar 2019 13:32:02 GMT -->
</html>