<!doctype html>
<html  lang="en">
  
<!-- Mirrored from source.android.google.cn/devices/camera/camera3_requests_hal by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Mar 2019 14:28:53 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
          
<title>HAL Subsystem &nbsp;|&nbsp; Android Open Source Project</title>

<meta property="og:title" content="HAL Subsystem &nbsp;|&nbsp; Android Open Source Project">

  <meta property="og:url" content="camera3_requests_hal.html">

  <meta property="og:locale" content="en">


    
    
    
  
        <meta property="og:site_name" content="Android Open Source Project">
    <meta property="og:type" content="website">
    
          <meta name="theme-color" content="#78c257">
    
    <meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="../../_pwa/androidsource/manifest.json">
    <link rel="preconnect" href="http://www.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.googleapis.com/" crossorigin>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons">
    <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/css/app.css">
    <noscript>
      <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/css/ce_bundle.css">
    </noscript>
    <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/touchicon-180.png"><link rel="canonical" href="camera3_requests_hal.html"></head>
  <body type="article"
        theme="androidsource-theme"
        class=""
        
        layout="docs"
        pending>
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
    <div class="devsite-wrapper"><devsite-header ds-is="header" keep-tabs-visible>
      








<div class="devsite-header--inner">
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="Close menu">
        </button>
        <div class="devsite-product-name-wrapper">
  <a href="../../index.html" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo">
  <img src="https://www.gstatic.cn/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/lockup.svg" class="devsite-site-logo" alt="Android Open Source Project">
</a>
            <span class="devsite-product-name">
            <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                              </li>
  </ul>
          </span>
        
</div>        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
                          <devsite-tabs ds-is="tabs" class="upper-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="../../setup.html"
   class="gc-analytics-event"
   title="Set up"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Set up"
   >
  Set up
</a>

        </tab>
                        <tab >
          <a href="../../compatibility.html"
   class="gc-analytics-event"
   title="Design"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Design"
   >
  Design
</a>

        </tab>
                        <tab >
          <a href="../../security.html"
   class="gc-analytics-event"
   title="Secure"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Secure"
   >
  Secure
</a>

        </tab>
                        <tab active>
          <a href="../audio.html"
   class="gc-analytics-event"
   title="Develop"
   aria-label="Develop, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: Develop"
   >
  Develop
</a>

        </tab>
                        <tab >
          <a href="../tech/dalvik.html"
   class="gc-analytics-event"
   title="Configure"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Configure"
   >
  Configure
</a>

        </tab>
                        <tab >
          <a href="../../reference.html"
   class="gc-analytics-event"
   title="Reference"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Reference"
   >
  Reference
</a>

        </tab>
            </div>
</devsite-tabs>

                       </div>
          <devsite-search ds-is="search"
            enable-suggestions
                  project-path="">
  <form class="devsite-search-form" action="https://source.android.google.cn/s/results/" method="GET">
    <div class="devsite-search-container">
      <div id="searchbox" class="devsite-searchbox">
                <input placeholder="Search"
          type="text"
          class="devsite-search-field devsite-search-query"
          name="q"
          value=""
          autocomplete="off"
                    aria-label="Search box">
        <div class="devsite-search-image material-icons"></div>
      </div>
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              aria-label="Open search box"></button>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          aria-label="Close search box"></button>
</devsite-search>

        </div>

                <a class="devsite-header-link devsite-top-button button gc-analytics-event"
           href="http://android-review.googlesource.com/"
           data-category="Site-Wide Custom Events"
           data-label="Site header link">
          Go to code
        </a>
                      </div>    </div>  </div>
  <div class="devsite-collapsible-section
    ">
    <div class="devsite-header-background">
                        <div class="devsite-product-id-row">
            <div class="devsite-product-description-row">
                              <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                    <a href="../audio.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Lower Header"
              data-value="1"
          >
            Develop
      
  </a>
        </li>
  </ul>
                                        </div>
                                                                                    </div>
                                      <div class="devsite-doc-set-nav-row">
                              <devsite-tabs ds-is="tabs" class="lower-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="../audio.html"
   class="gc-analytics-event"
   title="Audio"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Audio"
   >
  Audio
</a>

        </tab>
                        <tab active>
          <a href="../camera.html"
   class="gc-analytics-event"
   title="Camera"
   aria-label="Camera, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: Camera"
   >
  Camera
</a>

        </tab>
                        <tab >
          <a href="../tech/connect.html"
   class="gc-analytics-event"
   title="Connectivity"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Connectivity"
   >
  Connectivity
</a>

        </tab>
                        <tab >
          <a href="../graphics.html"
   class="gc-analytics-event"
   title="Graphics"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Graphics"
   >
  Graphics
</a>

        </tab>
                        <tab >
          <a href="../input.html"
   class="gc-analytics-event"
   title="Interaction"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Interaction"
   >
  Interaction
</a>

        </tab>
                        <tab >
          <a href="../media.html"
   class="gc-analytics-event"
   title="Media"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Media"
   >
  Media
</a>

        </tab>
                        <tab >
          <a href="../storage.html"
   class="gc-analytics-event"
   title="Storage"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Storage"
   >
  Storage
</a>

        </tab>
            </div>
</devsite-tabs>

        </div>
          </div>  </div></div>
  

  </devsite-header>      <devsite-book-nav ds-is="book-nav" scrollbars >
                  

<nav class="devsite-book-nav devsite-nav nocontent">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="Close navigation">
    </button>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
              <ul class="devsite-nav-list">
                      <li class="devsite-nav-item">
                                <a href="../../setup.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Set up">
      <span class="devsite-nav-text" >Set up</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../compatibility.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Design">
      <span class="devsite-nav-text" >Design</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../security.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Secure">
      <span class="devsite-nav-text" >Secure</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../audio.html"
          class="devsite-nav-title gc-analytics-event
            devsite-nav-active"
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Develop">
      <span class="devsite-nav-text" >Develop</span>
        </a>
  
                                            <ul class="devsite-nav-responsive-tabs">
                                                                                                                      <li class="devsite-nav-item">
    <a href="../audio.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Audio">
      <span class="devsite-nav-text" >Audio</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../camera.html"
     id="devsite-nav-forward"     class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Camera">
      <span class="devsite-nav-text" menu="_book">Camera</span>
        <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="_book">
    </span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../tech/connect.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Connectivity">
      <span class="devsite-nav-text" >Connectivity</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../graphics.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Graphics">
      <span class="devsite-nav-text" >Graphics</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../input.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Interaction">
      <span class="devsite-nav-text" >Interaction</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../media.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Media">
      <span class="devsite-nav-text" >Media</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../storage.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Storage">
      <span class="devsite-nav-text" >Storage</span>
        </a>
  </li>

                                  </ul>
                          </li>
                      <li class="devsite-nav-item">
                                <a href="../tech/dalvik.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Configure">
      <span class="devsite-nav-text" >Configure</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../reference.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Reference">
      <span class="devsite-nav-text" >Reference</span>
        </a>
  
                                        </li>
                                <li class="devsite-nav-item">
    <a href="http://android-review.googlesource.com/"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Go to code">
      <span class="devsite-nav-text" >Go to code</span>
        </a>
  </li>

                  </ul>
          </div>
          <div class="devsite-mobile-nav-bottom">
                                      <ul class="devsite-nav-list" menu="_book">
                                    <li class="devsite-nav-item"><a href="../camera.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li>
                          <li class="devsite-nav-item"><a href="camera3.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Camera3">Camera3</span></a></li>
                          <li class="devsite-nav-item"><a href="camera3_requests_hal.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="HAL Subsystem">HAL Subsystem</span></a></li>
                          <li class="devsite-nav-item"><a href="camera3_metadata.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Metadata and Controls">Metadata and Controls</span></a></li>
                          <li class="devsite-nav-item"><a href="camera3_3Amodes.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="3A Modes and State">3A Modes and State</span></a></li>
                          <li class="devsite-nav-item"><a href="camera3_crop_reprocess.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Output and Cropping">Output and Cropping</span></a></li>
                          <li class="devsite-nav-item"><a href="camera3_error_stream.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Errors and Streams">Errors and Streams</span></a></li>
                          <li class="devsite-nav-item"><a href="camera3_requests_methods.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Request Creation">Request Creation</span></a></li>
                          <li class="devsite-nav-item"><a href="external-usb-cameras.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="External USB Cameras">External USB Cameras</span></a></li>
                          <li class="devsite-nav-item"><a href="multi-camera.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Multi-Camera Support">Multi-Camera Support</span></a></li>
                          <li class="devsite-nav-item"><a href="motion-tracking.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Motion Tracking">Motion Tracking</span></a></li>
                          <li class="devsite-nav-item"><a href="session-parameters.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Session Parameters">Session Parameters</span></a></li>
                          <li class="devsite-nav-item"><a href="singleprod-multiconsum.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Single Producer, Multiple Consumer">Single Producer, Multiple Consumer</span></a></li>
                          <li class="devsite-nav-item"><a href="versioning-2.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Version Support">Version Support</span></a></li>
                      </ul>
                                                                                                                                                                            </div>
      </div>
</nav>
              </devsite-book-nav>
      <div id="gc-wrapper">
        <div class="devsite-main-content"
            has-book-nav            has-toc>
          <devsite-toc ds-is="toc" class="devsite-nav"
            ></devsite-toc>
          <devsite-content ds-is="content">
                          

<article class="devsite-article">
  <article class="devsite-article-inner">    
    <div class="devsite-article-meta">
      <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                    <a href="../../index.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="1"
          >
            AOSP
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item">
                <div class="devsite-breadcrumb-guillemet material-icons"></div>
                    <a href="../audio.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="2"
          >
            Develop
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item">
                <div class="devsite-breadcrumb-guillemet material-icons"></div>
                    <a href="../camera.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="3"
          >
            Camera
      
  </a>
        </li>
  </ul>
               <devsite-page-rating position="header" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
          </div>

              <h1 class="devsite-page-title">HAL Subsystem</h1>
    
    <devsite-toc ds-is="toc" class="devsite-nav" devsite-toc-embedded
                 ></devsite-toc>

    <div class="devsite-article-body clearfix
      ">

              
  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->



<h2 id="requests">Requests</h2>
<p> The app framework issues requests for captured results to the camera subsystem.
  One request corresponds to one set of results. A request encapsulates all
  configuration information about the capturing and processing of those results.
  This includes things such as resolution and pixel format; manual sensor, lens,
  and flash control; 3A operating modes; RAW to YUV processing control; and
  statistics generation. This allows for much more control over the results'
  output and processing. Multiple requests can be in flight at once, and
  submitting requests is non-blocking. And the requests are always processed in
  the order they are received.</p>
  <img src="images/camera_model.png" alt="Camera request model" id="figure1" />
  <p class="img-caption">
  <strong>Figure 1.</strong> Camera model
</p>
<h2 id="hal-subsystem">The HAL and camera subsystem</h2>
<p> The camera subsystem includes the implementations for components in the camera
  pipeline such as the 3A algorithm and processing controls. The camera HAL
  provides interfaces for you to implement your versions of these components. To
  maintain cross-platform compatibility between multiple device manufacturers and
  Image Signal Processor (ISP, or camera sensor) vendors, the camera pipeline
  model is virtual and does not directly correspond to any real ISP. However, it
  is similar enough to real processing pipelines so that you can map it to your
  hardware efficiently. In addition, it is abstract enough to allow for multiple
  different algorithms and orders of operation without compromising either
  quality, efficiency, or cross-device compatibility.</p>
<p>The camera pipeline also supports triggers that the app framework can initiate
  to turn on things such as auto-focus. It also sends notifications back to the
  app framework, notifying apps of events such as an auto-focus lock or errors.</p>
  <img src="images/camera_hal.png" alt="Camera hardware abstraction layer" id="figure2" />
  <p class="img-caption">
  <strong>Figure 2.</strong> Camera pipeline</p>
<p>Please note, some image processing blocks shown in the diagram above are not
  well-defined in the initial release. The camera pipeline makes the following
  assumptions:</p>
<ul>
  <li>RAW Bayer output undergoes no processing inside the ISP.</li>
  <li>Statistics are generated based off the raw sensor data.</li>
  <li>The various processing blocks that convert raw sensor data to YUV are in an
    arbitrary order.</li>
  <li>While multiple scale and crop units are shown, all scaler units share the
    output region controls (digital zoom). However, each unit may have a different
    output resolution and pixel format.</li>
</ul>
<p><strong>Summary of API use</strong><br/>
  This is a brief summary of the steps for using the Android camera API. See the
  Startup and expected operation sequence section for a detailed breakdown of
  these steps, including API calls.</p>
<ol>
  <li>Listen for and enumerate camera devices.</li>
  <li>Open device and connect listeners.</li>
  <li>Configure outputs for target use case (such as still capture, recording,
    etc.).</li>
  <li>Create request(s) for target use case.</li>
  <li>Capture/repeat requests and bursts.</li>
  <li>Receive result metadata and image data.</li>
  <li>When switching use cases, return to step 3.</li>
</ol>
<p><strong>HAL operation summary</strong></p>
<ul>
  <li>Asynchronous requests for captures come from the framework.</li>
  <li>HAL device must process requests in order. And for each request, produce
    output result metadata, and one or more output image buffers.</li>
  <li>First-in, first-out for requests and results, and for streams referenced by
    subsequent requests. </li>
  <li>Timestamps must be identical for all outputs from a given request, so that the
    framework can match them together if needed. </li>
  <li>All capture configuration and state (except for the 3A routines) is
    encapsulated in the requests and results.</li>
</ul>
<img src="images/camera-hal-overview.png" alt="Camera HAL overview" id="figure3" />
<p class="img-caption">
  <strong>Figure 3.</strong> Camera HAL overview
</p>
<h2 id="startup">Startup and expected operation sequence</h2>
<p>This section contains a detailed explanation of the steps expected when using
  the camera API. Please see <a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/">platform/hardware/interfaces/camera/</a> for HIDL interface
  definitions.</p>

<h3 id="open-camera-device">Enumerating, opening camera devices and
creating an active session</h3>
<ol>
  <li>After initialization, the framework starts listening for any present
    camera providers that implement the
    <code><a href="https://android.googlesource.com/platform/hardware/interfaces/+/master/camera/provider/2.4/ICameraProvider.hal">ICameraProvider</a></code> interface. If such provider or
    providers are present, the framework will try to establish a connection.</li>
  <li>The framework enumerates the camera devices via
    <code>ICameraProvider::getCameraIdList()</code>.</li>
  <li>The framework instantiates a new <code>ICameraDevice</code> by calling the respective
    <code>ICameraProvider::getCameraDeviceInterface_VX_X()</code>.</li>
  <li>The framework calls <code>ICameraDevice::open()</code> to create a new
    active capture session ICameraDeviceSession.</li>
</ol>

<h3 id="use-active-session">Using an active camera session</h3>

<ol>
  <li>The framework calls <code>ICameraDeviceSession::configureStreams()</code>
    with a list of input/output streams to the HAL device.</li>
  <li>The framework requests default settings for some use cases with
    calls to <code>ICameraDeviceSession::constructDefaultRequestSettings()</code>.
    This may occur at any time after the <code>ICameraDeviceSession</code> is
    created by <code>ICameraDevice::open</code>.
  </li>
  <li>The framework constructs and sends the first capture request to the HAL with
    settings based on one of the sets of default settings, and with at least one
    output stream that has been registered earlier by the framework. This is sent
    to the HAL with <code>ICameraDeviceSession::processCaptureRequest()</code>.
    The HAL must block the return of this call until it is ready for the next
    request to be sent.</li>
  <li>The framework continues to submit requests and calls
    <code>ICameraDeviceSession::constructDefaultRequestSettings()</code> to get
    default settings buffers for other use cases as necessary.</li>
  <li>When the capture of a request begins (sensor starts exposing for the
    capture), the HAL calls <code>ICameraDeviceCallback::notify()</code> with
    the SHUTTER message, including the frame number and the timestamp for start
    of exposure. This notify callback does not have to happen before the first
    <code>processCaptureResult()</code> call for a request, but no results are
    delivered to an application for a capture until after
    <code>notify()</code> for that capture is called.
  </li>
  <li>After some pipeline delay, the HAL begins to return completed captures to
    the framework with <code>ICameraDeviceCallback::processCaptureResult()</code>.
    These are returned in the same order as the requests were submitted. Multiple
    requests can be in flight at once, depending on the pipeline depth of the
    camera HAL device.</li>
</ol>

<p>After some time, one of the following will occur:</p>
  <ul>
  <li>The framework may stop submitting new requests, wait for
    the existing captures to complete (all buffers filled, all results
    returned), and then call <code>ICameraDeviceSession::configureStreams()</code>
    again. This resets the camera hardware and pipeline for a new set of
    input/output streams. Some streams may be reused from the previous
    configuration. The framework then continues from the first capture request
    to the HAL, if at least one
    registered output stream remains. (Otherwise,
    <code>ICameraDeviceSession::configureStreams()</code> is required first.)</li>
  <li>The framework may call <code>ICameraDeviceSession::close()</code>
    to end the camera session. This may be called at any time when no other calls
    from the framework are active, although the call may block until all
    in-flight captures have completed (all results returned, all buffers
    filled). After the <code>close()</code> call returns, no more calls to
    <code>ICameraDeviceCallback</code> are allowed from the HAL. Once the
    <code>close()</code> call is underway, the framework may not call any other
    HAL device functions.</li>
  <li>In case of an error or other asynchronous event, the HAL must call
    <code>ICameraDeviceCallback::notify()</code> with the appropriate
    error/event message.
    After returning from a fatal device-wide error notification, the HAL should
    act as if <code>close()</code> had been called on it. However, the HAL must
    either cancel
    or complete all outstanding captures before calling <code>notify()</code>,
    so that once
    <code>notify()</code> is called with a fatal error, the framework will not
    receive further callbacks from the device. Methods besides
    <code>close()</code> should return
    -ENODEV or NULL after the <code>notify()</code> method returns from a fatal
    error message.</li>
  </ul>
<img src="images/camera-ops-flow.png" alt="Camera operations flow" id="figure4" width="485"/>
<p class="img-caption">
  <strong>Figure 4.</strong> Camera operational flow
</p>
<h2 id="hardware-levels">Hardware levels</h2>
<p>Camera devices can implement several hardware levels depending on their
  capabilities. For more information, see
  <a href="https://developer.android.google.cn/reference/android/hardware/camera2/CameraCharacteristics#INFO_SUPPORTED_HARDWARE_LEVEL">supported hardware level</a>.</p>
<h2 id="interaction">Interaction between the application capture request, 3A
control, and the processing pipeline</h2>
<p>Depending on the settings in the 3A control block, the camera pipeline ignores
  some of the parameters in the application's capture request and uses the values
  provided by the 3A control routines instead. For example, when auto-exposure is
  active, the exposure time, frame duration, and sensitivity parameters of the
  sensor are controlled by the platform 3A algorithm, and any app-specified values
  are ignored. The values chosen for the frame by the 3A routines must be reported
  in the output metadata. The following table describes the different modes of the
  3A control block and the properties that are controlled by these modes. See
  the <a href="https://android.googlesource.com/platform/system/media/+/master/camera/docs/docs.html">platform/system/media/camera/docs/docs.html</a> file for definitions of these properties.</p>
<table>
  <tr>
    <th>Parameter</th>
    <th>State</th>
    <th>Properties controlled</th>
  </tr>
  <tr>
    <td>android.control.aeMode</td>
    <td>OFF</td>
    <td>None</td>
  </tr>
  <tr>
    <td></td>
    <td>ON</td>
    <td>android.sensor.exposureTime
      android.sensor.frameDuration
      android.sensor.sensitivity
      android.lens.aperture (if supported)
      android.lens.filterDensity (if supported)</td>
  </tr>
  <tr>
    <td></td>
    <td>ON_AUTO_FLASH</td>
    <td>Everything is ON, plus android.flash.firingPower, android.flash.firingTime, and android.flash.mode</td>
  </tr>
  <tr>
    <td></td>
    <td>ON_ALWAYS_FLASH</td>
    <td>Same as ON_AUTO_FLASH</td>
  </tr>
  <tr>
    <td></td>
    <td>ON_AUTO_FLASH_RED_EYE</td>
    <td>Same as ON_AUTO_FLASH</td>
  </tr>
  <tr>
    <td>android.control.awbMode</td>
    <td>OFF</td>
    <td>None</td>
  </tr>
  <tr>
    <td></td>
    <td>WHITE_BALANCE_*</td>
    <td>android.colorCorrection.transform. Platform-specific adjustments if android.colorCorrection.mode is FAST or HIGH_QUALITY.</td>
  </tr>
  <tr>
    <td>android.control.afMode</td>
    <td>OFF</td>
    <td>None</td>
  </tr>
  <tr>
    <td></td>
    <td>FOCUS_MODE_*</td>
    <td>android.lens.focusDistance</td>
  </tr>
  <tr>
    <td>android.control.videoStabilization</td>
    <td>OFF</td>
    <td>None</td>
  </tr>
  <tr>
    <td></td>
    <td>ON</td>
    <td>Can adjust android.scaler.cropRegion to implement video stabilization</td>
  </tr>
  <tr>
    <td>android.control.mode</td>
    <td>OFF</td>
    <td>AE, AWB, and AF are disabled</td>
  </tr>
  <tr>
    <td></td>
    <td>AUTO</td>
    <td>Individual AE, AWB, and AF settings are used</td>
  </tr>
  <tr>
    <td></td>
    <td>SCENE_MODE_*</td>
    <td>Can override all parameters listed above. Individual 3A controls are disabled.</td>
  </tr>
</table>
<p>The controls in the Image Processing block in Figure 2 all operate on a
  similar principle, and generally each block has three modes:</p>
<ul>
  <li>OFF: This processing block is disabled. The demosaic, color correction, and
    tone curve adjustment blocks cannot be disabled.</li>
  <li>FAST: In this mode, the processing block may not slow down the output frame
    rate compared to OFF mode, but should otherwise produce the best-quality
    output it can given that restriction. Typically, this would be used for
    preview or video recording modes, or burst capture for still images. On some
    devices, this may be equivalent to OFF mode (no processing can be done without
    slowing down the frame rate), and on some devices, this may be equivalent to
    HIGH_QUALITY mode (best quality still does not slow down frame rate).</li>
  <li>HIGH_QUALITY: In this mode, the processing block should produce the best
    quality result possible, slowing down the output frame rate as needed.
    Typically, this would be used for high-quality still capture. Some blocks
    include a manual control which can be optionally selected instead of FAST or
    HIGH_QUALITY. For example, the color correction block supports a color
    transform matrix, while the tone curve adjustment supports an arbitrary global
    tone mapping curve.</li>
</ul>
  <p>The maximum frame rate that can be supported by a camera subsystem is a function
  of many factors:</p>
<ul>
  <li>Requested resolutions of output image streams</li>
  <li>Availability of binning/skipping modes on the imager</li>
  <li>The bandwidth of the imager interface</li>
  <li>The bandwidth of the various ISP processing blocks</li>
</ul>
<p>Since these factors can vary greatly between different ISPs and sensors, the
  camera HAL interface tries to abstract the bandwidth restrictions into as simple
  model as possible. The model presented has the following characteristics:</p>
<ul>
  <li>The image sensor is always configured to output the smallest resolution
    possible given the application's requested output stream sizes.  The smallest
    resolution is defined as being at least as large as the largest requested
    output stream size.</li>
  <li>Since any request may use any or all the currently configured output streams,
    the sensor and ISP must be configured to support scaling a single capture to
    all the streams at the same time. </li>
  <li>JPEG streams act like processed YUV streams for requests for which they are
    not included; in requests in which they are directly referenced, they act as
    JPEG streams.</li>
  <li>The JPEG processor can run concurrently to the rest of the camera pipeline but
    cannot process more than one capture at a time.</li>
</ul>

  
          </div>

    
                   <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
                   
          </article>
</article>

<devsite-content-footer ds-is="content-footer" class="nocontent">
  <p>Content and code samples on this page are subject to the licenses described in the <a href="../../license.html">Content License</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
</devsite-content-footer>


                      </devsite-content>
        </div>
        <devsite-footer-promos ds-is="footer-promos" class="devsite-footer">
                      
                  </devsite-footer-promos>
        <devsite-footer-linkboxes ds-is="footer-linkboxes" class="devsite-footer">
                      <nav class="devsite-footer-linkboxes nocontent">
  <ul class="devsite-footer-linkboxes-list">
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Build</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.googlesource.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android repository
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../../setup/build/requirements.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            Requirements
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../../setup/build/downloading.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Downloading
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/blobs-preview/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            Preview binaries
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/images/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Factory images
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/drivers/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Driver binaries
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.github.io/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            GitHub
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Connect</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/Android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            @Android on Twitter
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/AndroidDev/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            @AndroidDev on Twitter
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://blog.google/products/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Android Blog
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://security.googleblog.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            Google Security Blog
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-platform/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Platform on Google Groups
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-building/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Building on Google Groups
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-porting/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            Porting on Google Groups
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Get help</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/pixelphone/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            Pixel Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/nexus/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Nexus Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            www.android.com
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/gms/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Google Mobile Services
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://stackoverflow.com/questions/tagged/android-source/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Stack Overflow
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://issuetracker.google.com/issues?q=status:open%20componentid:190923"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            Issue Tracker
          </a>
        </li>
              </ul>
    </li>
      </ul>
</nav>
                  </devsite-footer-linkboxes>
        <devsite-footer-utility ds-is="footer-utility" class="devsite-footer">
                      <div class="devsite-footer-utility">
  
  <nav class="devsite-nav">
        <ul class="devsite-footer-utility-list">
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../source/index.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer About Android link">
          About Android
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../setup/community.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer Community link">
          Community
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../legal.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer Legal link">
          Legal
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../license.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer License link">
          License
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://policies.google.cn/privacy"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link">
          Privacy
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://issuetracker.google.com/issues/new?component=191476"
           data-category="Site-Wide Custom Events"
           data-label="Footer Site feedback link">
          Site feedback
        </a>
              </li>
          </ul>
    
        <form class="devsite-footer-utility-language">
      <select class="devsite-footer-utility-language-select"
              name="language"
              track-name="click"
              track-type="languageSelector">
                  <option value="en"
                  track-metadata-original-language="en"
                  track-metadata-selected-language="en"
                  track-name="changed"
                  track-type="languageSelector"
                  selected="selected">
            English
          </option>
                  <option value="zh_cn"
                  track-metadata-original-language="en"
                  track-metadata-selected-language="zh_cn"
                  track-name="changed"
                  track-type="languageSelector"
                  >
            简体中文
          </option>
              </select>
    </form>
      </nav>
</div>
                  </devsite-footer-utility>
      </div></div>
    <devsite-sitemask ds-is="site-mask"></devsite-sitemask>
    <devsite-snackbar ds-is="snackbar"                       ></devsite-snackbar>    <devsite-tooltip ds-is="tooltip"
                     blocked-link></devsite-tooltip>
    <devsite-analytics ds-is="analytics">
              <script type="application/json" analytics>[{"metrics": {"ratings_value": "metric1", "ratings_count": "metric2"}, "dimensions": {}, "gaid": "UA-45455297-4"}]</script>
<script type="application/json" gtm>[]</script>
          </devsite-analytics>
    <script>
    (function(d,e,v,E,l,o,p,r,s,_,__){d['GoogleDevelopersObject']=[!0,l,o,p,r,s];
    _=e.createElement(v);_.async=1;_.src=E;__=e.getElementsByTagName(v)[0];
    __.parentNode.insertBefore(_,__);})(window, document, 'script',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/js/app_loader.js',
      'en',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/js/devsite_app.js',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource',
      !1,
      ['/_pwa/androidsource/manifest.json',
       'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/images/video-placeholder.svg',
       'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/favicon.png','https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/lockup.svg','https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons'],
       'https://androidsource-dot-google-developers.gonglchuangl.net/')
   </script>  </body>

<!-- Mirrored from source.android.google.cn/devices/camera/camera3_requests_hal by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Mar 2019 14:28:57 GMT -->
</html>