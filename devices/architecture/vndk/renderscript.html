<!doctype html>
<html  lang="en">
  
<!-- Mirrored from source.android.google.cn/devices/architecture/vndk/renderscript by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Mar 2019 14:10:16 GMT -->
<!-- Added by HTTrack --><meta http-equiv="content-type" content="text/html;charset=utf-8" /><!-- /Added by HTTrack -->
<head>
          
<title>Renderscript &nbsp;|&nbsp; Android Open Source Project</title>

<meta property="og:title" content="Renderscript &nbsp;|&nbsp; Android Open Source Project">

  <meta property="og:url" content="renderscript.html">

  <meta property="og:locale" content="en">


    
    
    
  
        <meta property="og:site_name" content="Android Open Source Project">
    <meta property="og:type" content="website">
    
          <meta name="theme-color" content="#78c257">
    
    <meta charset="utf-8">
    <meta content="IE=Edge" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="manifest" href="../../../_pwa/androidsource/manifest.json">
    <link rel="preconnect" href="http://www.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.gstatic.com/" crossorigin>
    <link rel="preconnect" href="http://fonts.googleapis.com/" crossorigin>
    <link rel="stylesheet" href="http://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons">
    <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/css/app.css">
    <noscript>
      <link rel="stylesheet" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/css/ce_bundle.css">
    </noscript>
    <link rel="shortcut icon" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/favicon.png">
    <link rel="apple-touch-icon" href="https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/touchicon-180.png"><link rel="canonical" href="renderscript.html"></head>
  <body type="article"
        theme="androidsource-theme"
        class=""
        
        layout="docs"
        pending>
    <devsite-progress type="indeterminate" id="app-progress"></devsite-progress>
    <div class="devsite-wrapper"><devsite-header ds-is="header" keep-tabs-visible>
      








<div class="devsite-header--inner">
  <div class="devsite-top-logo-row-wrapper-wrapper">
    <div class="devsite-top-logo-row-wrapper">
      <div class="devsite-top-logo-row">
        <button type="button" id="devsite-hamburger-menu"
          class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
          data-category="Site-Wide Custom Events"
          data-label="Navigation menu button"
          visually-hidden
          aria-label="Close menu">
        </button>
        <div class="devsite-product-name-wrapper">
  <a href="../../../index.html" class="devsite-site-logo-link gc-analytics-event"
   data-category="Site-Wide Custom Events" data-label="Site logo">
  <img src="https://www.gstatic.cn/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/lockup.svg" class="devsite-site-logo" alt="Android Open Source Project">
</a>
            <span class="devsite-product-name">
            <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                              </li>
  </ul>
          </span>
        
</div>        <div class="devsite-top-logo-row-middle">
          <div class="devsite-header-upper-tabs">
                          <devsite-tabs ds-is="tabs" class="upper-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="../../../setup.html"
   class="gc-analytics-event"
   title="Set up"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Set up"
   >
  Set up
</a>

        </tab>
                        <tab active>
          <a href="../../../compatibility.html"
   class="gc-analytics-event"
   title="Design"
   aria-label="Design, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: Design"
   >
  Design
</a>

        </tab>
                        <tab >
          <a href="../../../security.html"
   class="gc-analytics-event"
   title="Secure"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Secure"
   >
  Secure
</a>

        </tab>
                        <tab >
          <a href="../../audio.html"
   class="gc-analytics-event"
   title="Develop"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Develop"
   >
  Develop
</a>

        </tab>
                        <tab >
          <a href="../../tech/dalvik.html"
   class="gc-analytics-event"
   title="Configure"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Configure"
   >
  Configure
</a>

        </tab>
                        <tab >
          <a href="../../../reference.html"
   class="gc-analytics-event"
   title="Reference"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Reference"
   >
  Reference
</a>

        </tab>
            </div>
</devsite-tabs>

                       </div>
          <devsite-search ds-is="search"
            enable-suggestions
                  project-path="">
  <form class="devsite-search-form" action="https://source.android.google.cn/s/results/" method="GET">
    <div class="devsite-search-container">
      <div id="searchbox" class="devsite-searchbox">
                <input placeholder="Search"
          type="text"
          class="devsite-search-field devsite-search-query"
          name="q"
          value=""
          autocomplete="off"
                    aria-label="Search box">
        <div class="devsite-search-image material-icons"></div>
      </div>
      <button type="button"
              search-open
              class="devsite-search-button devsite-header-icon-button button-flat material-icons"
              aria-label="Open search box"></button>
    </div>
  </form>
  <button type="button"
          search-close
          class="devsite-search-button devsite-header-icon-button button-flat material-icons"
          aria-label="Close search box"></button>
</devsite-search>

        </div>

                <a class="devsite-header-link devsite-top-button button gc-analytics-event"
           href="http://android-review.googlesource.com/"
           data-category="Site-Wide Custom Events"
           data-label="Site header link">
          Go to code
        </a>
                      </div>    </div>  </div>
  <div class="devsite-collapsible-section
    ">
    <div class="devsite-header-background">
                        <div class="devsite-product-id-row">
            <div class="devsite-product-description-row">
                              <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                    <a href="../../../compatibility.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Lower Header"
              data-value="1"
          >
            Design
      
  </a>
        </li>
  </ul>
                                        </div>
                                                                                    </div>
                                      <div class="devsite-doc-set-nav-row">
                              <devsite-tabs ds-is="tabs" class="lower-tabs">
  <div class="devsite-tabs-wrapper">
                  <tab >
          <a href="../../../compatibility.html"
   class="gc-analytics-event"
   title="Overview"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Overview"
   >
  Overview
</a>

        </tab>
                        <tab active>
          <a href="../../architecture.html"
   class="gc-analytics-event"
   title="Architecture"
   aria-label="Architecture, selected"         data-category="Site-Wide Custom Events"
        data-label="Tab: Architecture"
   >
  Architecture
</a>

        </tab>
                        <tab >
          <a href="../../../compatibility/overview-2.html"
   class="gc-analytics-event"
   title="Compatibility"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Compatibility"
   >
  Compatibility
</a>

        </tab>
                        <tab >
          <a href="../../tech/display.html"
   class="gc-analytics-event"
   title="Display"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Display"
   >
  Display
</a>

        </tab>
                        <tab >
          <a href="../../tech/settings/settings-guidelines.html"
   class="gc-analytics-event"
   title="Settings"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Settings"
   >
  Settings
</a>

        </tab>
                        <tab >
          <a href="../../../compatibility/tests.html"
   class="gc-analytics-event"
   title="Tests"
           data-category="Site-Wide Custom Events"
        data-label="Tab: Tests"
   >
  Tests
</a>

        </tab>
            </div>
</devsite-tabs>

        </div>
          </div>  </div></div>
  

  </devsite-header>      <devsite-book-nav ds-is="book-nav" scrollbars >
                  

<nav class="devsite-book-nav devsite-nav nocontent">
  <div class="devsite-mobile-header">
    <button type="button"
            id="devsite-close-nav"
            class="devsite-header-icon-button button-flat material-icons gc-analytics-event"
            data-category="Site-Wide Custom Events"
            data-label="Close navigation"
            aria-label="Close navigation">
    </button>
  </div>

  <div class="devsite-book-nav-wrapper">
    <div class="devsite-mobile-nav-top">
              <ul class="devsite-nav-list">
                      <li class="devsite-nav-item">
                                <a href="../../../setup.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Set up">
      <span class="devsite-nav-text" >Set up</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../../compatibility.html"
          class="devsite-nav-title gc-analytics-event
            devsite-nav-active"
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Design">
      <span class="devsite-nav-text" >Design</span>
        </a>
  
                                            <ul class="devsite-nav-responsive-tabs">
                                                                                                                      <li class="devsite-nav-item">
    <a href="../../../compatibility.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Overview">
      <span class="devsite-nav-text" >Overview</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../architecture.html"
     id="devsite-nav-forward"     class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Architecture">
      <span class="devsite-nav-text" menu="_book">Architecture</span>
        <span class="devsite-nav-icon material-icons" data-icon="forward"
          menu="_book">
    </span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../../compatibility/overview-2.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Compatibility">
      <span class="devsite-nav-text" >Compatibility</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../tech/display.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Display">
      <span class="devsite-nav-text" >Display</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../tech/settings/settings-guidelines.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Settings">
      <span class="devsite-nav-text" >Settings</span>
        </a>
  </li>

                                                                                                                      <li class="devsite-nav-item">
    <a href="../../../compatibility/tests.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Tests">
      <span class="devsite-nav-text" >Tests</span>
        </a>
  </li>

                                  </ul>
                          </li>
                      <li class="devsite-nav-item">
                                <a href="../../../security.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Secure">
      <span class="devsite-nav-text" >Secure</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../audio.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Develop">
      <span class="devsite-nav-text" >Develop</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../tech/dalvik.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Configure">
      <span class="devsite-nav-text" >Configure</span>
        </a>
  
                                        </li>
                      <li class="devsite-nav-item">
                                <a href="../../../reference.html"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Reference">
      <span class="devsite-nav-text" >Reference</span>
        </a>
  
                                        </li>
                                <li class="devsite-nav-item">
    <a href="http://android-review.googlesource.com/"
          class="devsite-nav-title gc-analytics-event
            "
     data-category="Site-Wide Custom Events"
     data-label="Responsive Tab: Go to code">
      <span class="devsite-nav-text" >Go to code</span>
        </a>
  </li>

                  </ul>
          </div>
          <div class="devsite-mobile-nav-bottom">
                                      <ul class="devsite-nav-list" menu="_book">
                                    <li class="devsite-nav-item"><a href="../../architecture.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="Hardware Abstraction Layer (HAL)">Hardware Abstraction Layer (HAL)</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../hal.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Legacy HALs">Legacy HALs</span></a></li><li class="devsite-nav-item"><a href="../hal-types.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="HAL Types">HAL Types</span></a></li><li class="devsite-nav-item"><a href="../hal/framework-testing.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Framework Testing">Framework Testing</span></a></li><li class="devsite-nav-item"><a href="../hal/dynamic-lifecycle.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Dynamic Lifecycle">Dynamic Lifecycle</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="Kernel">Kernel</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../kernel.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="../kernel/releases.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Stable Releases &amp; Updates">Stable Releases &amp; Updates</span></a></li><li class="devsite-nav-item"><a href="../kernel/android-common.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Android Common Kernels">Android Common Kernels</span></a></li><li class="devsite-nav-item"><a href="../kernel/modular-kernels.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Modular Kernel Requirements">Modular Kernel Requirements</span></a></li><li class="devsite-nav-item"><a href="../kernel/reqs-interfaces.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Interface Requirements">Interface Requirements</span></a></li><li class="devsite-nav-item"><a href="../kernel/bpf.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Extending the kernel with eBPF">Extending the kernel with eBPF</span></a></li><li class="devsite-nav-item"><a href="../kernel/config.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Configuration">Configuration</span></a></li><li class="devsite-nav-item"><a href="../kernel/hardening.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Kernel Hardening">Kernel Hardening</span></a></li><li class="devsite-nav-item"><a href="../kernel/squashfs.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="SquashFS">SquashFS</span></a></li><li class="devsite-nav-item"><a href="../kernel/lldb-debug.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="LLDB Debugging">LLDB Debugging</span></a></li><li class="devsite-nav-item"><a href="../kernel/network_tests.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Network Tests">Network Tests</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="HIDL (General)">HIDL (General)</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../hidl.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="../hidl/interfaces.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Interfaces &amp; Packages">Interfaces &amp; Packages</span></a></li><li class="devsite-nav-item"><a href="../hidl/hashing.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Interface Hashing">Interface Hashing</span></a></li><li class="devsite-nav-item"><a href="../hidl/services.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Services &amp; Data Transfer">Services &amp; Data Transfer</span></a></li><li class="devsite-nav-item"><a href="../hidl/fmq.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Fast Message Queue">Fast Message Queue</span></a></li><li class="devsite-nav-item"><a href="../hidl/binder-ipc.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Using Binder IPC">Using Binder IPC</span></a></li><li class="devsite-nav-item"><a href="../hidl/memoryblock.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Using MemoryBlock">Using MemoryBlock</span></a></li><li class="devsite-nav-item"><a href="../hidl/network-stack.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Network Stack Configuration Tools">Network Stack Configuration Tools</span></a></li><li class="devsite-nav-item"><a href="../hidl/threading.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Threading Models">Threading Models</span></a></li><li class="devsite-nav-item"><a href="../hidl/converting.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Converting Modules">Converting Modules</span></a></li><li class="devsite-nav-item"><a href="../hidl/types.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Data Types">Data Types</span></a></li><li class="devsite-nav-item"><a href="../hidl/versioning.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Versioning">Versioning</span></a></li><li class="devsite-nav-item"><a href="../hidl/code-style.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Code Style Guide">Code Style Guide</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="HIDL (C++)">HIDL (C++)</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../hidl-cpp.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="../hidl-cpp/packages.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Packages">Packages</span></a></li><li class="devsite-nav-item"><a href="../hidl-cpp/interfaces.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Interfaces">Interfaces</span></a></li><li class="devsite-nav-item"><a href="../hidl-cpp/types.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Data Types">Data Types</span></a></li><li class="devsite-nav-item"><a href="../hidl-cpp/functions.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Functions">Functions</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="HIDL (Java)">HIDL (Java)</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../hidl-java.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="../hidl-java/types.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Data Types">Data Types</span></a></li><li class="devsite-nav-item"><a href="../hidl-java/interfaces.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Interface Errors &amp; Methods">Interface Errors &amp; Methods</span></a></li><li class="devsite-nav-item"><a href="../hidl-java/constants.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Exporting Constants">Exporting Constants</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="ConfigStore HAL">ConfigStore HAL</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../configstore.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="../configstore/interface.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Creating the HAL Interface">Creating the HAL Interface</span></a></li><li class="devsite-nav-item"><a href="../configstore/service.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Implementing the Service">Implementing the Service</span></a></li><li class="devsite-nav-item"><a href="../configstore/client.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Client-Side Usage">Client-Side Usage</span></a></li><li class="devsite-nav-item"><a href="../configstore/add-class-item.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Adding Classes &amp; Items">Adding Classes &amp; Items</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="Device Tree Overlays">Device Tree Overlays</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../dto.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="../dto/implement.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Implementing DTO">Implementing DTO</span></a></li><li class="devsite-nav-item"><a href="../dto/syntax.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="DTO Syntax">DTO Syntax</span></a></li><li class="devsite-nav-item"><a href="../dto/compile.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Compiling &amp; Verifying">Compiling &amp; Verifying</span></a></li><li class="devsite-nav-item"><a href="../dto/multiple.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Using Multiple DTs">Using Multiple DTs</span></a></li><li class="devsite-nav-item"><a href="../dto/partitions.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="DTB/DTBO Partition Format">DTB/DTBO Partition Format</span></a></li><li class="devsite-nav-item"><a href="../dto/optimize.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Optimizing DTO">Optimizing DTO</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="Vendor NDK">Vendor NDK</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../vndk.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="enabling.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Enabling the VNDK">Enabling the VNDK</span></a></li><li class="devsite-nav-item"><a href="build-system.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="VNDK Build System Support">VNDK Build System Support</span></a></li><li class="devsite-nav-item"><a href="extensions.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="VNDK Extensions">VNDK Extensions</span></a></li><li class="devsite-nav-item"><a href="deftool.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="VNDK Definition Tool">VNDK Definition Tool</span></a></li><li class="devsite-nav-item"><a href="snapshot-design.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="VNDK Snapshot Design">VNDK Snapshot Design</span></a></li><li class="devsite-nav-item"><a href="snapshot-generate.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Generating VNDK Snapshots">Generating VNDK Snapshots</span></a></li><li class="devsite-nav-item"><a href="linker-namespace.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Linker Namespace">Linker Namespace</span></a></li><li class="devsite-nav-item"><a href="dir-rules-sepolicy.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Directories, Rules, and sepolicy">Directories, Rules, and sepolicy</span></a></li><li class="devsite-nav-item"><a href="renderscript.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Renderscript">Renderscript</span></a></li><li class="devsite-nav-item"><a href="abi-stability.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="ABI Stability">ABI Stability</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="Vendor Interface Object">Vendor Interface Object</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../vintf.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="../vintf/objects.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Manifests">Manifests</span></a></li><li class="devsite-nav-item"><a href="../vintf/comp-matrices.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Compatibility Matrices">Compatibility Matrices</span></a></li><li class="devsite-nav-item"><a href="../vintf/fcm.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="FCM Lifecycle">FCM Lifecycle</span></a></li><li class="devsite-nav-item"><a href="../vintf/dm.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="DM Development">DM Development</span></a></li><li class="devsite-nav-item"><a href="../vintf/match-rules.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Matching Rules">Matching Rules</span></a></li><li class="devsite-nav-item"><a href="../vintf/resources.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Resources">Resources</span></a></li></ul></devsite-expandable-nav></li>
                          <li class="devsite-nav-item           devsite-nav-expandable"><devsite-expandable-nav ds-is="expandable-nav" collapsed>
    <a class="devsite-nav-toggle"></a><div class="devsite-nav-title devsite-nav-title-no-path" tabindex="0"><span class="devsite-nav-text" title="Bootloader">Bootloader</span></div><ul class="devsite-nav-section"><li class="devsite-nav-item"><a href="../../bootloader.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Overview">Overview</span></a></li><li class="devsite-nav-item"><a href="../../bootloader/boot-reason.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Boot Reason">Boot Reason</span></a></li><li class="devsite-nav-item"><a href="../../bootloader/boot-image-header.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Boot Image Header">Boot Image Header</span></a></li><li class="devsite-nav-item"><a href="../../bootloader/system-as-root.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="System as Root">System as Root</span></a></li><li class="devsite-nav-item"><a href="../../bootloader/partitions-images.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Partitions and Images">Partitions and Images</span></a></li><li class="devsite-nav-item"><a href="../../bootloader/product-partitions.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Product Partitions">Product Partitions</span></a></li><li class="devsite-nav-item"><a href="../../bootloader/recovery-image.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Recovery Image">Recovery Image</span></a></li><li class="devsite-nav-item"><a href="../../bootloader/flashing-updating.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Flashing and Updating">Flashing and Updating</span></a></li><li class="devsite-nav-item"><a href="../../bootloader/unlock-trusty.html"
     class="devsite-nav-title"
   ><span class="devsite-nav-text" title="Unlocking and Trusty">Unlocking and Trusty</span></a></li></ul></devsite-expandable-nav></li>
                      </ul>
                                                                                                                                                                            </div>
      </div>
</nav>
              </devsite-book-nav>
      <div id="gc-wrapper">
        <div class="devsite-main-content"
            has-book-nav            has-toc>
          <devsite-toc ds-is="toc" class="devsite-nav"
            ></devsite-toc>
          <devsite-content ds-is="content">
                          

<article class="devsite-article">
  <article class="devsite-article-inner">    
    <div class="devsite-article-meta">
      <ul class="devsite-breadcrumb-list">
    <li class="devsite-breadcrumb-item">
                    <a href="../../../index.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="1"
          >
            AOSP
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item">
                <div class="devsite-breadcrumb-guillemet material-icons"></div>
                    <a href="../../../compatibility.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="2"
          >
            Design
      
  </a>
        </li>
    <li class="devsite-breadcrumb-item">
                <div class="devsite-breadcrumb-guillemet material-icons"></div>
                    <a href="../../architecture.html"              class="devsite-breadcrumb-link gc-analytics-event"
              data-category="Site-Wide Custom Events"
              data-label="Breadcrumbs"
              data-value="3"
          >
            Architecture
      
  </a>
        </li>
  </ul>
               <devsite-page-rating position="header" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
          </div>

              <h1 class="devsite-page-title">Renderscript</h1>
    
    <devsite-toc ds-is="toc" class="devsite-nav" devsite-toc-embedded
                 ></devsite-toc>

    <div class="devsite-article-body clearfix
      ">

              
  <!--
      Copyright 2017 The Android Open Source Project

      Licensed under the Apache License, Version 2.0 (the "License");
      you may not use this file except in compliance with the License.
      You may obtain a copy of the License at

          http://www.apache.org/licenses/LICENSE-2.0

      Unless required by applicable law or agreed to in writing, software
      distributed under the License is distributed on an "AS IS" BASIS,
      WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
      See the License for the specific language governing permissions and
      limitations under the License.
  -->

<p>
  <em>RenderScript</em> is a framework for running computationally intensive
  tasks at high performance on Android. It is designed for use with
  data-parallel computation, although serial workloads can benefit as well. The
  RenderScript runtime parallelizes work across processors available on a
  device, such as multi-core CPUs and GPUs, enabling developers to focus on
  expressing algorithms rather than scheduling work. RenderScript is especially
  useful for applications performing image processing, computational
  photography, or computer vision.
</p>

<p>
  Devices running Android 8.0 and higher use the following RenderScript
  framework and vendor HALs:
</p>

<img src="../images/treble_rs_linking.png">
<figcaption>
  <strong>Figure 1.</strong> Vendor code linking to internal libs
</figcaption>

<p>
  Differences from RenderScript in Android 7.x and lower include:
</p>

<ul>
  <li>Two instances of RenderScript internal libs in a process. One set is for
  CPU fallback path and is from directly at <code>/system/lib</code>; the other
  set is for GPU path and is from <code>/system/lib/vndk-sp</code>.</li>
  <li>RS internal libs in <code>/system/lib</code> are built as part of the
  platform and are updated as <code>system.img</code> is upgraded. However, libs
  in <code>/system/lib/vndk-sp</code> are built for the vendor and are not
  updated when <code>system.img</code> is upgraded (while they can be updated
  for a security fix, their ABI remains the same).</li>
  <li>Vendor code (RS HAL, RS driver, and the <code>bcc plugin</code>) are
  linked against the RenderScript internal libs located at
  <code>/system/lib/vndk-sp</code>. They cannot link against libs in
  <code>/system/lib</code> because libs in that directory are built for the
  platform and thus may not be compatible with the vendor code (i.e., symbols
  may be removed). Doing so would make a framework-only OTA impossible.</li>
</ul>

<p>
  For more details, see
  <a href="https://developer.android.google.cn/guide/topics/renderscript/compute.html" class="external">Renderscript</a>
  on developer.android.com.
</p>

<h2 id="design">Design</h2>

<p>
  The following sections detail RenderScript design in Android 8.0 and higher.
</p>

<h3 id="renderscript-libs-available-to-vendors">RenderScript libs available to
vendors</h3>

<p>
  This section lists the RenderScript libs (known as Vendor NDK for Same-Process
  HALs or VNDK-SP) that are available to vendor code and which can be linked
  against. It also details additional libraries that are unrelated to
  RenderScript but which are also provided to vendor code.
</p>

<p>
  While the following list of libraries might differ between Android releases,
  it is immutable for a specific Android release; for an up-to-date list of
  available libraries, refer to <code>/system/etc/ld.config.txt</code>.
</p>

<aside class="note">
  <strong>Note:</strong> Libraries not listed below cannot be used by any vendor
  code; i.e. <code>libLLVM.so</code> cannot be used by the vendor's
  <code>bcc plugin</code> as the lib is not in the list.
</aside>

<table>
<tr>
<th style="width:50%">RenderScript Libs</th>
<th>Non-RenderScript Libs</th>
</tr>
<tr>
<td><ul>
<li><code>android.hardware.graphics.renderscript@1.0.so</code></li>
<li><code>libRS_internal.so</code></li>
<li><code>libRSCpuRef.so</code></li>
<li><code>libblas.so</code></li>
<li><code>libbcinfo.so</code></li>
<li><code>libcompiler_rt.so</code></li>
<li><code>libRSDriver.so</code></li>
</ul></td>
<td><ul>
<li><code>libc.so</code></li>
<li><code>libm.so</code></li>
<li><code>libdl.so</code></li>
<li><code>libstdc++.so</code></li>
<li><code>liblog.so</code></li>
<li><code>libnativewindow.so</code></li>
<li><code>libsync.so</code></li>
<li><code>libvndksupport.so</code></li>
<li><code>libbase.so</code></li>
<li><code>libc++.so</code></li>
<li><code>libcutils.so</code></li>
<li><code>libutils.so</code></li>
<li><code>libhardware.so</code></li>
<li><code>libhidlbase.so</code></li>
<li><code>libhidltransport.so</code></li>
<li><code>libhwbinder.so</code></li>
<li><code>liblzma.so</code></li>
<li><code>libz.so</code></li>
<li><code>libEGL.so</code></li>
<li><code>libGLESv1_CM.so</code></li>
<li><code>libGLESv2.so</code></li>
</ul></td>
  </tr>
</table>

<h3 id="linker-namespace-configuration">Linker namespace configuration</h3>

<p>
  The linking restriction that prevents libs not in VNDK-SP from being used by
  vendor code is enforced at runtime using the linker namespace. (For details,
  refer to the <a href="../images/VNDK.pdf">VNDK Design</a>
  presentation.)
</p>

<p>
  On a device running Android 8.0 and higher, all Same-Process HALs (SP-HALs)
  <em>except RenderScript</em> are loaded inside the linker namespace
  <code>sphal</code>. RenderScript is loaded into the RenderScript-specific
  namespace <code>rs</code>, a location that enables a slightly looser
  enforcement for RenderScript libs. Because the RS implementation needs to load
  the compiled bitcode, <code>/data/*/*.so</code> is added to the path of the
  <code>rs</code> namespace (other SP-HALs are not allowed to load libs from the
  data partition).
</p>

<p>
  In addition, the <code>rs</code> namespace allows more libs than provided for
  by other namespaces. <code>libmediandk.so</code> and <code>libft2.so</code>
  are exposed to the <code>rs</code> namespace because
  <code>libRS_internal.so</code> has an internal dependency to these libraries.
</p>

<img src="../images/treble_rs_namespace.png">
<figcaption>
  <strong>Figure 2.</strong> Namespace configuration for linker
</figcaption>

<h3 id="loading-drivers">Loading drivers</h3>

<h4>CPU fallback path</h4>

<p>
  Depending on the existence of the <code>RS_CONTEXT_LOW_LATENCY</code> bit
  when creating an RS context, either the CPU or GPU path is selected. When the
  CPU path is selected, <code>libRS_internal.so</code> (the main implementation
  of the RS framework) is directly <code>dlopen</code>ed from the default linker
  namespace where the platform version of RS libs are provided.
</p>

<p>
  The RS HAL implementation from the vendor is not used at all when the CPU
  fallback path is taken, and an <code>RsContext</code> object is created with
  null <code>mVendorDriverName</code>. <code>libRSDriver.so</code> is (by
  default) <code>dlopen</code>ed and the driver lib is loaded from the
  <code>default</code> namespace because the caller
  (<code>libRS_internal.so</code>) is also loaded in the <code>default</code>
  namespace.
</p>

<img src="../images/treble_rs_cpu_fallback.png">
<figcaption>
  <strong>Figure 4.</strong> CPU fallback path
</figcaption>

<h4 id="gpu-path">GPU path</h4>

<p>
  For the GPU path, the <code>libRS_internal.so</code> is loaded differently.
  First, <code>libRS.so</code> uses
  <code>android.hardware.renderscript@1.0.so</code> (and its underlying
  <code>libhidltransport.so</code>) to load
  <code>android.hardware.renderscript@1.0-impl.so</code> (a vendor
  implementation of RS HAL) into a different linker namespace called
  <code>sphal</code>. The RS
  HAL then <code>dlopen</code>s <code>libRS_internal.so</code> in a another
  linker namespace called <code>rs</code>.
</p>

<p>
  Vendors can provide their own RS driver by setting the build time flag
  <code>OVERRIDE_RS_DRIVER</code>, which is embedded into the RS HAL
  implementation
  (<code>hardware/interfaces/renderscript/1.0/default/Context.cpp</code>). This
  driver name is then <code>dlopen</code>ed for the RS context for the GPU path.
</p>

<p>
  The creation of the <code>RsContext</code> object is delegated to the RS HAL
  implementation. The HAL calls back to the RS framework using
  <code>rsContextCreateVendor()</code> function with the name of the driver to
  use as an argument. The RS framework then loads the specified driver when the
  <code>RsContext</code> is initialized. In this case, the driver library is
  loaded into the <code>rs</code> namespace because the <code>RsContext</code>
  object is created inside the <code>rs</code> namespace and
  <code>/vendor/lib</code> is in the search path of the namespace.
</p>

<img src="../images/treble_rs_gpu_fallback.png">
<figcaption>
  <strong>Figure 5.</strong> GPU fallback path
</figcaption>

<p>
  When transitioning from the <code>default</code> namespace to the
  <code>sphal</code> namespace, <code>libhidltransport.so</code> uses the
  <code>android_load_sphal_library()</code> function to explicitly order the
  dynamic linker to load the <code>-impl.so</code> library from the
  <code>sphal</code> namespace.
</p>

<p>
  When transitioning from the <code>sphal</code> namespace to the
  <code>rs</code> namespace, loading is done indirectly by the following line in
  <code>/system/etc/ld.config.txt</code>:
</p>

<pre class="prettyprint">
namespace.sphal.link.rs.shared_libs = libRS_internal.so
</pre>

<p>
  This line specifies the dynamic linker should load
  <code>libRS_internal.so</code> from the <code>rs</code> namespace when the lib
  can't be found/loaded from the <code>sphal</code> namespace (which is always
  the case because <code>sphal</code> namespace does not search
  <code>/system/lib/vndk-sp</code> where <code>libRS_internal.so</code>
  resides). With this configuration, a simple <code>dlopen()</code> call to
  <code>libRS_internal.so</code> is enough to make the namespace transition.
</p>

<h3 id="loading-bcc-plugin">Loading bcc plugin</h3>

<p>
  <code>bcc plugin</code> is a vendor-provided library loaded into the
  <code>bcc</code> compiler. Because <code>bcc</code> is a system process in the
  <code>/system/bin</code> directory, the <code>bcc plugin</code> library can be
  considered an SP-HAL (i.e., a vendor HAL that can be directly loaded into the
  system process without being binderized). As an SP-HAL, the
  <code>bcc-plugin</code> library:
</p>

<ul>
  <li>Cannot link against framework-only libraries such as
  <code>libLLVM.so</code>.</li>
  <li>Can link against only the VNDK-SP libraries available to the vendor.</li>
</ul>

<p>
  This restriction is enforced by loading the <code>bcc plugin</code> into the
  <code>sphal</code> namespace using the
  <code>android_sphal_load_library()</code> function. In previous versions of
  Android, the plugin name was specified using the <code>-load</code> option and
  the lib was loaded using the simple <code>dlopen()</code> by
  <code>libLLVM.so</code>. In Android 8.0 and higher, this is specified in the
  <code>-plugin</code> option and the lib is directly loaded by the
  <code>bcc</code> itself. This option enables a non-Android-specific path to
  the open source LLVM project.
</p>

<img src="../images/treble_rs_bcc_plugin_old.png">
<figcaption>
  <strong>Figure 6.</strong> Loading bcc plugin, Android 7.x and lower
</figcaption>
<br>
<br>
<img src="../images/treble_rs_bcc_plugin_new.png">
  <figcaption><strong>Figure 7.</strong> Loading bcc plugin, Android 8.0 and
  higher
</figcaption>

<h3 id="search-paths-for-ld-mc">Search paths for ld.mc</h3>

<p>
  When executing <code>ld.mc</code>, some RS runtime libs are given as inputs
  to the linker. The RS bitcode from the app is linked against the runtime libs
  and when the converted bitcode is loaded into an app process, the runtime libs
  are again dynamically linked from the converted bitcode.
</p>

<p>Runtime libs include:</p>

<ul>
  <li><code>libcompiler_rt.so</code></li>
  <li><code>libm.so</code></li>
  <li><code>libc.so</code></li>
  <li>RS driver (either <code>libRSDriver.so</code> or
  <code>OVERRIDE_RS_DRIVER</code>)</li>
</ul>

<p>
  When loading the compiled bitcode into the app process, provide the exact same
  library that was used by <code>ld.mc</code>. Otherwise, the compiled bitcode
  may not find a symbol which was available when it was linked.
</p>

<p>
  To do so, RS framework uses different search paths for the runtime libs when
  executing <code>ld.mc</code>, depending on whether the RS framework itself is
  loaded from <code>/system/lib</code> or from <code>/system/lib/vndk-sp</code>.
  This can be determined by reading the address of an arbitrary symbol of a RS
  framework lib and using <code>dladdr()</code> to get the file path mapped to
  the address.
</p>

<h3 id="selinux-policy">SELinux policy</h3>

<p>
  As a result of the SELinux policy changes in Android 8.0 and higher, you must
  follow specific rules (enforced through <code>neverallows</code>) when
  labelling additional files in <code>vendor</code> partition:
</p>

<ul>
  <li><code>vendor_file</code> must be the default label in for all files in
  <code>vendor</code> partition. The platform policy requires this to access
  passthrough HAL implementations.</li>
  <li>All new <code>exec_types</code> added in <code>vendor</code> partition
  through vendor SEPolicy must have <code>vendor_file_type</code> attribute.
  This is enforced through <code>neverallows</code>.</li>
  <li>To avoid conflicts with future platform/framework updates, avoid labelling
  files other than <code>exec_types</code> in <code>vendor</code> partition.
  </li>
  <li>All library dependencies for AOSP-identified same process HALs must be
  labelled as <code>same_process_hal_file</code>.</li>
</ul>

<p>
  For details on SELinux policy, see
  <a href="../../../security/selinux/index-3.html">Security-Enhanced Linux in Android</a>.
</p>

<h3 id="abi-compatibility-for-bitcode">ABI compatibility for bitcode</h3>

<p>
  If no new APIs are added, which means no HAL version bump, the RS frameworks
  will keep using the existing GPU (HAL 1.0) driver.
</p>

<p>
  For minor HAL changes (HAL 1.1) not affecting bitcode, the frameworks should
  fallback to CPU for these newly added APIs and keep using GPU (HAL 1.0) driver
  elsewhere.
</p>

<p>
  For major HAL changes (HAL 2.0) affecting bitcode compilation/linking, RS
  frameworks should choose not to load vendor-provided GPU drivers and instead
  use the CPU or Vulkan path for acceleration.
</p>

<p>Consuming RenderScript bitcode occurs in three stages:</p>

<table>
<tr>
<th>Stage</th>
<th>Details</th>
</tr>
<tr>
<td><em>Compile</em></td>
<td>
  <ul>
    <li>The input bitcode (.bc) for <code>bcc</code> must be in
    <code>LLVM 3.2</code> bitcode format and <code>bcc</code> must be backward
     compatible with existing (legacy) apps.</li>
    <li>However, the meta-data in .bc could change (there could new runtime
    functions, e.g, Allocation setters &mp; getters, math functions, etc.). Part
    of the runtime functions lives in <code>libclcore.bc</code>, part of them
    lives in LibRSDriver or vendor equivalent.</li>
    <li>New runtime functions or breaking meta-data changes require incrementing
    the bitcode API level. Because vendor drivers won't be able to consume it,
    the HAL version must also be incremented.</li>
    <li>Vendors may have their own compilers, but the conclusions/requirements
    for <code>bcc</code> also apply to those compilers.</li>
  </ul>
</td>
</tr>
<tr>
<td><em>Link</em></td>
<td>
  <ul>
    <li>The compiled .o will be linked with vendor driver, e.g,
    <code>libRSDriver_foo.so</code>, and <code>libcompiler_rt.so</code>. The CPU
    path will link with <code>libRSDriver.so</code>.</li>
    <li>If the .o requires a new runtime API from <code>libRSDriver_foo</code>,
    the vendor driver has to be updated to support it.</li>
    <li>Certain vendors may have their own linkers, but the argument for
    <code>ld.mc</code> also apply to them.</li>
  </ul>
</td>
</tr>
<tr>
<td><em>Load</em></td>
<td>
  <ul>
    <li><code>libRSCpuRef</code> loads the shared object. If there are
    changes to this interface, a HAL version bump is needed.</li>
    <li>Vendors would either rely on <code>libRSCpuRef</code> to load the shared
    object, or implement their own.</li>
  </ul>
</td>
</tr>
</table>

<p>
  In addition to the HAL, runtime APIs and the exported symbols are also
  interfaces. Neither interface has changed since Android 7.0 (API 24) and there
  are no immediate plans to change it in Android 8.0 and beyond. However, if the
  interface does change, the HAL version will also increment.
</p>

<h2 id="vendor-implementations">Vendor implementations</h2>

<p>
  Android 8.0 and higher requires some GPU driver changes for the GPU driver to
  work correctly.
</p>

<h3 id="driver-modules">Driver modules</h3>

<ul>
  <li>Driver modules must not depend on any system libraries that are not in
  <a href="#renderscript-libs-available-to-vendors">the list</a>.</li>
  <li>Driver must provide its own
  <code>android.hardware.renderscript@1.0-impl_{NAME}</code>, or declare the
  default implementation <code>android.hardware.renderscript@1.0-impl</code> as
  its dependency.</li>
  <li>CPU implementation <code>libRSDriver.so</code> is a good example of how to
  remove non-VNDK-SP dependencies.</li>
</ul>

<h3 id="bitcode-compiler">Bitcode compiler</h3>

<p>
  You can compile RenderScript bitcode for the vendor driver in two ways:
</p>

<ol>
  <li>Invoke vendor-specific RenderScript compiler in <code>/vendor/bin/</code>
  (preferred method of GPU compilation). Similar to other driver modules, the
  vendor compiler binary cannot depend on any system library that is not in the
  list of <a href="#renderscript-libs-available-to-vendors">RenderScript libs
  available to vendors</a>.</li>
  <li>Invoke system bcc: <code>/system/bin/bcc</code> with a vendor-provided
  <code>bcc plugin</code>; this plugin cannot depend on any system library that
  is not in the list of
  <a href="#renderscript-libs-available-to-vendors">RenderScript libs available
  to vendors</a>.</li>
</ol>

<p>
  If the vendor <code>bcc plugin</code> needs to interfere with the CPU
  compilation and its dependency on <code>libLLVM.so</code> cannot be easily
  removed, the vendor should copy <code>bcc</code> (and all the non-LL-NDK
  dependencies, including <code>libLLVM.so</code>, <code>libbcc.so</code>) into
  <code>/vendor</code> partition.
</p>

<p>
  In addition, vendors need to make the following changes:
</p>

<img src="../images/treble_rs_vendor_driver.png">
<figcaption>
  <strong>Figure 8.</strong> Changes to vendor driver
</figcaption>

<ol>
  <li>Copy <code>libclcore.bc</code> to <code>/vendor</code> partition. This
  ensures <code>libclcore.bc</code>, <code>libLLVM.so</code>, and
  <code>libbcc.so</code> are in sync.</li>
  <li>Change the path to the <code>bcc</code> executable by setting
  <code>RsdCpuScriptImpl::BCC_EXE_PATH</code> from the RS HAL implementation.
  </li>
</ol>

<aside class="note">
  <strong>Note:</strong> Restrictions for <code>/vendor/bin/*</code> processes
  are not fully implemented. While not recommended, it is theoretically possible
  to just copy <code>bcc</code> to <code>/vendor/bin/</code> without copying its
  dependencies.
</aside>

<h3 id="selinux-policy">SELinux policy</h3>

<p>
  SELinux policy affects both the driver and the compiler executables. All
  driver modules must be labeled <code>same_process_hal_file</code> in the
  device's <code>file_contexts</code>. For example:
</p>

<pre class="prettyprint">
/vendor/lib(64)?/libRSDriver_EXAMPLE\.so     u:object_r:same_process_hal_file:s0
</pre>

<p>
  The compiler executable must be able to be invoked by an app process, as does
  the vendor copy of bcc (<code>/vendor/bin/bcc</code>). For example:
</p>

<pre class="prettyprint">
device/vendor_foo/device_bar/sepolicy/file_contexts:
/vendor/bin/bcc                    u:object_r:same_process_hal_file:s0
</pre>

<h3 id="legacy-devices">Legacy devices</h3>

<p>
  Legacy devices are those that satisfy the following conditions:
</p>

<ol>
  <li><em>PRODUCT_SHIPPING_API_LEVEL</em> is lower than 26.</li>
  <li><em>PRODUCT_FULL_TREBLE_OVERRIDE</em> is not defined.</li>
</ol>

<p>
  For legacy devices, the restrictions are not enforced when upgrading to
  Android 8.0 and higher, meaning the drivers can continue to link to libraries
  in <code>/system/lib[64]</code>. However, because of the architecture change
  related to <code>OVERRIDE_RS_DRIVER</code>,
  <code>android.hardware.renderscript@1.0-impl</code> must be installed to
  <code>/vendor</code> partition; failing to do so forces RenderScript runtime
  fallback to CPU path.
</p>

  
          </div>

    
                   <devsite-page-rating position="footer" selected-rating="0" hover-rating-star="0">
         </devsite-page-rating>
                   
          </article>
</article>

<devsite-content-footer ds-is="content-footer" class="nocontent">
  <p>Content and code samples on this page are subject to the licenses described in the <a href="../../../license.html">Content License</a>. Java is a registered trademark of Oracle and/or its affiliates.</p>
</devsite-content-footer>


                      </devsite-content>
        </div>
        <devsite-footer-promos ds-is="footer-promos" class="devsite-footer">
                      
                  </devsite-footer-promos>
        <devsite-footer-linkboxes ds-is="footer-linkboxes" class="devsite-footer">
                      <nav class="devsite-footer-linkboxes nocontent">
  <ul class="devsite-footer-linkboxes-list">
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Build</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.googlesource.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android repository
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../../../setup/build/requirements.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            Requirements
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="../../../setup/build/downloading.html"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Downloading
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/blobs-preview/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            Preview binaries
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/images/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Factory images
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://developers.google.com/android/drivers/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Driver binaries
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://android.github.io/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            GitHub
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Connect</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/Android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            @Android on Twitter
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://twitter.com/AndroidDev/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            @AndroidDev on Twitter
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://blog.google/products/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Android Blog
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://security.googleblog.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            Google Security Blog
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-platform/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Platform on Google Groups
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-building/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Building on Google Groups
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://groups.google.com/forum/?fromgroups#!forum/android-porting/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            Porting on Google Groups
          </a>
        </li>
              </ul>
    </li>
        <li class="devsite-footer-linkbox ">
    <h3 class="devsite-footer-linkbox-heading">Get help</h3>      <ul class="devsite-footer-linkbox-list">
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/android/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 1)"           >
            Android Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/pixelphone/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 2)"           >
            Pixel Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://support.google.com/nexus/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 3)"           >
            Nexus Help Center
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 4)"           >
            www.android.com
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://www.android.com/gms/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 5)"           >
            Google Mobile Services
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://stackoverflow.com/questions/tagged/android-source/"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 6)"           >
            Stack Overflow
          </a>
        </li>
                <li class="devsite-footer-linkbox-item">
          <a href="http://issuetracker.google.com/issues?q=status:open%20componentid:190923"
             class="devsite-footer-linkbox-link
                    gc-analytics-event"
             data-category="Site-Wide Custom Events"
                        data-label="Footer Link (index 7)"           >
            Issue Tracker
          </a>
        </li>
              </ul>
    </li>
      </ul>
</nav>
                  </devsite-footer-linkboxes>
        <devsite-footer-utility ds-is="footer-utility" class="devsite-footer">
                      <div class="devsite-footer-utility">
  
  <nav class="devsite-nav">
        <ul class="devsite-footer-utility-list">
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../../source/index.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer About Android link">
          About Android
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../../setup/community.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer Community link">
          Community
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../../legal.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer Legal link">
          Legal
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="../../../license.html"
           data-category="Site-Wide Custom Events"
           data-label="Footer License link">
          License
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://policies.google.cn/privacy"
           data-category="Site-Wide Custom Events"
           data-label="Footer Privacy link">
          Privacy
        </a>
              </li>
            <li class="devsite-footer-utility-item
                 ">
                        <a class="devsite-footer-utility-link
                  gc-analytics-event"
           href="http://issuetracker.google.com/issues/new?component=191476"
           data-category="Site-Wide Custom Events"
           data-label="Footer Site feedback link">
          Site feedback
        </a>
              </li>
          </ul>
    
        <form class="devsite-footer-utility-language">
      <select class="devsite-footer-utility-language-select"
              name="language"
              track-name="click"
              track-type="languageSelector">
                  <option value="en"
                  track-metadata-original-language="en"
                  track-metadata-selected-language="en"
                  track-name="changed"
                  track-type="languageSelector"
                  selected="selected">
            English
          </option>
                  <option value="zh_cn"
                  track-metadata-original-language="en"
                  track-metadata-selected-language="zh_cn"
                  track-name="changed"
                  track-type="languageSelector"
                  >
            
          </option>
              </select>
    </form>
      </nav>
</div>
                  </devsite-footer-utility>
      </div></div>
    <devsite-sitemask ds-is="site-mask"></devsite-sitemask>
    <devsite-snackbar ds-is="snackbar"                       ></devsite-snackbar>    <devsite-tooltip ds-is="tooltip"
                     blocked-link></devsite-tooltip>
    <devsite-analytics ds-is="analytics">
              <script type="application/json" analytics>[{"metrics": {"ratings_value": "metric1", "ratings_count": "metric2"}, "dimensions": {}, "gaid": "UA-45455297-4"}]</script>
<script type="application/json" gtm>[]</script>
          </devsite-analytics>
    <script>
    (function(d,e,v,E,l,o,p,r,s,_,__){d['GoogleDevelopersObject']=[!0,l,o,p,r,s];
    _=e.createElement(v);_.async=1;_.src=E;__=e.getElementsByTagName(v)[0];
    __.parentNode.insertBefore(_,__);})(window, document, 'script',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/js/app_loader.js',
      'en',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/js/devsite_app.js',
      'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource',
      !1,
      ['/_pwa/androidsource/manifest.json',
       'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/images/video-placeholder.svg',
       'https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/favicon.png','https://www.gstatic.com/devrel-devsite/v804714fbf31610f6bd494c83c2b0ed270c7475db2947bab1f550f430dad1ed36/androidsource/images/lockup.svg','https://fonts.googleapis.com/css?family=Roboto:300,400,400italic,500,500italic,700,700italic|Roboto+Mono:400,500,700|Material+Icons'],
       'https://androidsource-dot-google-developers.gonglchuangl.net/')
   </script>  </body>

<!-- Mirrored from source.android.google.cn/devices/architecture/vndk/renderscript by HTTrack Website Copier/3.x [XR&CO'2014], Sat, 16 Mar 2019 14:10:23 GMT -->
</html>